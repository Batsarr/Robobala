<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RoboBala - Test DPad</title>
  <style>
    body { background: #111; color: #fff; font-family: Arial, sans-serif; padding: 20px }
    .dpad-container { display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr 1fr; gap: 5px; max-width: 150px; margin: 15px auto; }
    .dpad-btn { background-color: #61dafb; color: #282c34; border-radius: 5px; font-size: 2em; line-height: 1; padding: 5px; cursor: pointer; border: none; }
  </style>
</head>
<body>
  <h3>Test DPad</h3>
  <div class="dpad-input-group"><label for="dpadDistInput">Dystans (cm):</label><input type="number" id="dpadDistInput" value="20"></div>
  <div class="dpad-input-group"><label for="dpadAngleInput">Kat (st.):</label><input type="number" id="dpadAngleInput" value="90"></div>
  <div class="dpad-container">
    <button id="dpad-up" class="dpad-btn" data-dpad="up">↑</button>
    <button id="dpad-left" class="dpad-btn" data-dpad="left">←</button>
    <button id="dpad-stop" class="dpad-btn" data-dpad="stop">×</button>
    <button id="dpad-right" class="dpad-btn" data-dpad="right">→</button>
    <button id="dpad-down" class="dpad-btn" data-dpad="down">↓</button>
  </div>
  <div>
    <button id="connectBtn">Connect (Mock)</button>
    <div id="log"></div>
  </div>

  <script>
    // Minimal environment — ensure functions expected in main.js are present
    window.sentMessages = [];
    window.addLogMessage = function(msg, level) { const l = document.getElementById('log'); l.innerText = (new Date()).toISOString() + ' ' + msg + '\n' + l.innerText; };
    // Build a mock commLayer that captures messages
    window.commLayer = {
      isConnected: false,
      connect: async function() { this.isConnected = true; return true; },
      getConnectionStatus: function() { return this.isConnected; },
      send: function(message) { window.sentMessages.push(message); console.log('Mock send:', message); },
      onMessage: function() {},
      offMessage: function() {}
    };
    // Expose reference so main.js uses it
    window.SERVICE_UUID = 'mock-service';
    window.RX_UUID = 'mock-rx';
    window.TX_UUID = 'mock-tx';
  </script>
  <script src="../main.js"></script>
  <script>
    document.getElementById('connectBtn').addEventListener('click', async () => {
      await commLayer.connect();
      addLogMessage('[TEST] mock connected', 'info');
      // Ensure D-pad buttons are not disabled
      document.querySelectorAll('.dpad-btn').forEach(b => b.disabled = false);
    });

    // Run a quick test after connect
    document.getElementById('connectBtn').addEventListener('click', () => {
      window.sentMessages.length = 0;
      setTimeout(() => {
        document.getElementById('dpad-up').click();
        setTimeout(() => {
          document.getElementById('dpad-left').click();
          setTimeout(() => {
            document.getElementById('dpad-stop').click();
            setTimeout(() => {
              addLogMessage('[TEST] Sent messages: ' + JSON.stringify(window.sentMessages), 'info');
            }, 100);
          }, 100);
        }, 100);
      }, 100);
    });

  </script>
</body>
</html>
