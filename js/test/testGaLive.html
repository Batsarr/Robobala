<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>GA Live Update Test</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <h2>GA Live Update Test</h2>
  <div id="autotuning-card-content-wrapper"></div>

  <!-- Load app scripts (bundled main.js + modular tuning_algorithms.js if necessary) -->
  <script src="../js/tuning_algorithms.js"></script>
  <script src="../js/main.js"></script>

  <script>
    // Wait for DOM and the core scripts to be available
    document.addEventListener('DOMContentLoaded', () => {
      // Create minimal structure used by the functions
      const panel = document.createElement('div');
      panel.innerHTML = `
        <div id="tuning-progress-panel">
          <p>Status: <span id="tuning-status-text">Oczekuje</span></p>
          <p>Iteracja: <span id="current-iteration">0</span> / <span id="total-iterations">0</span></p>
          <p>Pokolenie: <span id="current-generation">0</span> / <span id="ga-gen-total">0</span></p>
          <p>Osobnik: <span id="current-individual">0</span> / <span id="population-size">0</span></p>
          <p>Parametry: Kp: <span id="current-kp">---</span> Ki: <span id="current-ki">---</span> Kd: <span id="current-kd">---</span></p>
          <p>Fitness: <span id="current-fitness">---</span></p>
          <div id="ga-results-blocks" class="results-blocks"></div>
          <table class="autotune-results-table"><tbody id="results-table-body"></tbody></table>
        </div>
      `;
      document.getElementById('autotuning-card-content-wrapper').appendChild(panel);

      // Small delay to ensure functions exist
      setTimeout(() => {
        try {
          window.updateCurrentTestDisplay(2, 10, 4, 10, 100.5, 0.12, 3.3, 123.4567);
          addTestToResultsTable(1, { kp: 100.5, ki: 0.12, kd: 3.3 }, 123.4567, 1.23, 2.1, 'metrics_test', { gen: 2, totalGen: 10, individualIdx: 4, pop: 10 });
          console.log('UI elements updated. Current fitness:', document.getElementById('current-fitness').textContent);
          const row = document.querySelector('#results-table-body tr td');
          console.log('First cell content (should include test number):', row ? row.textContent : 'No row');
        } catch (e) {
          console.error('Test failed:', e);
        }
      }, 300);
    });
  </script>
</body>
</html>
