<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RoboBala - Sterowanie</title>
    <link rel="stylesheet" href="css/style_new.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body class="theme-dark">
    <!-- Splash Screen -->
    <div id="splashScreen" class="splash-screen active">
        <div class="splash-content">
            <div class="splash-logo">ü§ñ</div>
            <h1 class="splash-title">RoboBala</h1>
            <p class="splash-subtitle">Panel Sterowania</p>
            <div class="splash-spinner"></div>
        </div>
    </div>

    <!-- Emergency FAB -->
    <button id="emergencyFab" class="fab-emergency" title="Awaryjne zatrzymanie robota">
        <span class="fab-icon">‚èπ</span>
        <span class="fab-text">STOP</span>
    </button>

    <!-- Sticky Header -->
    <header class="app-header">
        <button id="menuToggle" class="menu-toggle" aria-label="Otw√≥rz menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <h1 class="app-title">RoboBala</h1>
        <div class="header-status">
            <span class="status-dot" id="connectionDot"></span>
            <span class="status-text" id="connectionText">Roz≈ÇƒÖczony</span>
        </div>
    </header>

    <!-- Off-Canvas Sidebar -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
            <button id="sidebarClose" class="sidebar-close" aria-label="Zamknij menu">&times;</button>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" data-view="dashboard" class="active">
                <span class="menu-icon">üéõÔ∏è</span>
                <span>Pulpit Sterowniczy</span>
            </a></li>
            <li><a href="#" data-view="pid-tuning">
                <span class="menu-icon">‚öôÔ∏è</span>
                <span>Strojenie PID</span>
            </a></li>
            <li><a href="#" data-view="calibration">
                <span class="menu-icon">üéØ</span>
                <span>Kalibracja</span>
            </a></li>
            <li><a href="#" data-view="autonomous">
                <span class="menu-icon">ü§ñ</span>
                <span>Sterowanie Autonomiczne</span>
            </a></li>
            <li><a href="#" data-view="diagnostics">
                <span class="menu-icon">üîç</span>
                <span>Diagnostyka</span>
            </a></li>
            <li><a href="#" data-view="settings">
                <span class="menu-icon">‚ö°</span>
                <span>Ustawienia</span>
            </a></li>
        </ul>
        <div class="sidebar-footer">
            <button id="themeToggle" class="theme-toggle">
                <span class="theme-icon">üåô</span>
                <span class="theme-label">Tryb Ciemny</span>
            </button>
        </div>
    </nav>

    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Main Content -->
    <main class="app-content">
        <!-- Dashboard View (Default) -->
        <section id="viewDashboard" class="view active">
            <!-- Connection Card -->
            <div class="card">
                <button id="connectBtn" class="btn btn-primary btn-large">
                    <span>Po≈ÇƒÖcz z Robotem</span>
                </button>
            </div>

            <!-- Virtual Joystick -->
            <div class="card joystick-card">
                <h2 class="card-title">Sterowanie
                    <span class="tooltip-icon" data-tooltip="U≈ºywaj joysticka do kontroli ruchu robota. Prz√≥d/ty≈Ç kontroluje prƒôdko≈õƒá, lewo/prawo obr√≥t.">?</span>
                </h2>
                <div id="joystickContainer" class="joystick-container">
                    <canvas id="joystickCanvas"></canvas>
                </div>
            </div>

            <!-- Main Toggles -->
            <div class="card">
                <h2 class="card-title">Tryby Pracy</h2>
                <div class="toggle-group">
                    <div class="toggle-item">
                        <label for="balanceToggle" class="toggle-label">
                            <span>Balansowanie</span>
                            <span class="tooltip-icon" data-tooltip="W≈ÇƒÖcz, aby robot aktywnie utrzymywa≈Ç r√≥wnowagƒô pionowƒÖ.">?</span>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="balanceToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-item">
                        <label for="holdPositionToggle" class="toggle-label">
                            <span>Trzymaj Pozycjƒô</span>
                            <span class="tooltip-icon" data-tooltip="Robot bƒôdzie pr√≥bowa≈Ç pozostaƒá w miejscu, korygujƒÖc dryf.">?</span>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="holdPositionToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-item">
                        <label for="speedModeToggle" class="toggle-label">
                            <span>Tryb Prƒôdko≈õci</span>
                            <span class="tooltip-icon" data-tooltip="W≈ÇƒÖcz kontrolƒô prƒôdko≈õci zamiast kontroli kƒÖta pochylenia.">?</span>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="speedModeToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Telemetry -->
            <div class="card">
                <h2 class="card-title">Telemetria</h2>
                <div class="telemetry-grid">
                    <div class="telemetry-item">
                        <span class="telemetry-label">Pitch</span>
                        <span class="telemetry-value" id="pitchValue">0.0¬∞</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Roll</span>
                        <span class="telemetry-value" id="rollValue">0.0¬∞</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Yaw</span>
                        <span class="telemetry-value" id="yawValue">0.0¬∞</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Czas Pƒôtli</span>
                        <span class="telemetry-value" id="loopTimeValue">0 Œºs</span>
                    </div>
                </div>
            </div>

            <!-- 3D Visualization -->
            <div class="card">
                <h2 class="card-title">Model 3D
                    <span class="tooltip-icon" data-tooltip="Wizualizacja orientacji robota w czasie rzeczywistym.">?</span>
                </h2>
                <div id="robot3DContainer" class="robot-3d-container"></div>
                <div class="button-group">
                    <button id="reset3DView" class="btn btn-secondary btn-small">Resetuj Widok</button>
                    <button id="toggle3DAnimation" class="btn btn-secondary btn-small">W≈Ç./Wy≈Ç. Animacjƒô</button>
                </div>
            </div>
        </section>

        <!-- PID Tuning View -->
        <section id="viewPidTuning" class="view">
            <div class="card">
                <h2 class="card-title">Strojenie PID</h2>
                
                <!-- PID Tabs -->
                <div class="tabs">
                    <button class="tab active" data-tab="balance">Balans</button>
                    <button class="tab" data-tab="speed">Prƒôdko≈õƒá</button>
                    <button class="tab" data-tab="position">Pozycja</button>
                </div>

                <!-- Balance PID Tab -->
                <div id="tabBalance" class="tab-content active">
                    <div class="accordion">
                        <button class="accordion-btn">Nastawy Podstawowe</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="balanceKp">
                                    Kp - Si≈Ça
                                    <span class="tooltip-icon" data-tooltip="Okre≈õla, jak mocno robot reaguje na bie≈ºƒÖcy b≈ÇƒÖd przechy≈Çu. Zbyt du≈ºa warto≈õƒá powoduje oscylacje.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceKp" value="95" min="0" max="500" step="0.1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="balanceKi">
                                    Ki - Korekta
                                    <span class="tooltip-icon" data-tooltip="Eliminuje d≈Çugotrwa≈Çy, sta≈Çy b≈ÇƒÖd. Czƒôsto nie jest potrzebny dla balansu.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceKi" value="0" min="0" max="10" step="0.01">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="balanceKd">
                                    Kd - T≈Çumienie
                                    <span class="tooltip-icon" data-tooltip="Dzia≈Ça jak amortyzator - przeciwdzia≈Ça szybkim zmianom kƒÖta i wyg≈Çadza ruch.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceKd" value="3.23" min="0" max="50" step="0.01">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion">
                        <button class="accordion-btn">Ustawienia Zaawansowane</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="balanceFilterAlpha">
                                    Filtr Pochodnej (%)
                                    <span class="tooltip-icon" data-tooltip="Wyg≈Çadza sygna≈Ç r√≥≈ºniczkujƒÖcy (Kd), redukujƒÖc wp≈Çyw szum√≥w z czujnika.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceFilterAlpha" value="100" min="1" max="100" step="1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="balanceIntegralLimit">
                                    Limit Integratora
                                    <span class="tooltip-icon" data-tooltip="Maksymalna warto≈õƒá, jakƒÖ mo≈ºe osiƒÖgnƒÖƒá suma ca≈ÇkujƒÖca (Ki).">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceIntegralLimit" value="50" min="0" max="200" step="1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Speed PID Tab -->
                <div id="tabSpeed" class="tab-content">
                    <p class="info-text">Parametry PID prƒôdko≈õci bƒôdƒÖ dostƒôpne tutaj...</p>
                </div>

                <!-- Position PID Tab -->
                <div id="tabPosition" class="tab-content">
                    <p class="info-text">Parametry PID pozycji bƒôdƒÖ dostƒôpne tutaj...</p>
                </div>

                <!-- Save/Load Buttons -->
                <div class="button-group mt-3">
                    <button id="loadConfig" class="btn btn-secondary">Wczytaj z Robota</button>
                    <button id="saveConfig" class="btn btn-primary">Zapisz na Robocie</button>
                </div>
            </div>
        </section>

        <!-- Other Views (Calibration, Autonomous, Diagnostics, Settings) -->
        <section id="viewCalibration" class="view">
            <div class="card">
                <h2 class="card-title">Kalibracja</h2>
                <p class="info-text">Narzƒôdzia kalibracji bƒôdƒÖ dostƒôpne tutaj...</p>
            </div>
        </section>

        <section id="viewAutonomous" class="view">
            <div class="card">
                <h2 class="card-title">Sterowanie Autonomiczne</h2>
                <p class="info-text">Funkcje autonomiczne bƒôdƒÖ dostƒôpne tutaj...</p>
            </div>
        </section>

        <section id="viewDiagnostics" class="view">
            <div class="card">
                <h2 class="card-title">Diagnostyka</h2>
                <p class="info-text">Narzƒôdzia diagnostyczne bƒôdƒÖ dostƒôpne tutaj...</p>
            </div>
        </section>

        <section id="viewSettings" class="view">
            <div class="card">
                <h2 class="card-title">Ustawienia</h2>
                <p class="info-text">Ustawienia aplikacji bƒôdƒÖ dostƒôpne tutaj...</p>
            </div>
        </section>
    </main>

    <!-- Collapsible Log Sheet -->
    <div id="logSheet" class="log-sheet">
        <div class="log-header" id="logHeader">
            <div class="log-title-area">
                <h3 class="log-title">Logi Systemowe</h3>
                <span class="log-badge" id="logBadge">0</span>
            </div>
            <div class="log-controls">
                <label class="log-autoscroll">
                    <input type="checkbox" id="logAutoscroll" checked>
                    <span>Auto-scroll</span>
                </label>
                <button id="clearLogs" class="btn-icon" title="Wyczy≈õƒá logi">üóëÔ∏è</button>
                <button id="logToggle" class="btn-icon log-toggle-icon" aria-label="Rozwi≈Ñ/zwi≈Ñ logi">
                    <span class="chevron">‚ñ≤</span>
                </button>
            </div>
        </div>
        <div class="log-content" id="logContent">
            <div id="logMessages"></div>
        </div>
    </div>

    <!-- Load Scripts -->
    <script src="js/main_new.js"></script>
</body>
</html>
