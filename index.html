<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RoboBala - Sterowanie</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body class="theme-dark">
    <!-- Splash Screen -->
    <div id="splashScreen" class="splash-screen active">
        <div class="splash-content">
            <div class="splash-logo">ü§ñ</div>
            <h1 class="splash-title">RoboBala</h1>
            <p class="splash-subtitle">Panel Sterowania</p>
            <div class="splash-spinner"></div>
        </div>
    </div>

    <!-- Emergency FAB -->
    <button id="emergencyFab" class="fab-emergency" title="Awaryjne zatrzymanie robota">
        <span class="fab-icon">‚èπ</span>
        <span class="fab-text">STOP</span>
    </button>

    <!-- Sticky Header -->
    <header class="app-header">
        <button id="menuToggle" class="menu-toggle" aria-label="Otw√≥rz menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <h1 class="app-title">RoboBala</h1>
        <div class="header-status">
            <span class="status-dot" id="connectionDot"></span>
            <span class="status-text" id="connectionText">Roz≈ÇƒÖczony</span>
        </div>
    </header>

    <!-- Off-Canvas Sidebar -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
            <button id="sidebarClose" class="sidebar-close" aria-label="Zamknij menu">&times;</button>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" data-view="dashboard" class="active">
                <span class="menu-icon">üéõÔ∏è</span>
                <span>Pulpit Sterowniczy</span>
            </a></li>
            <li><a href="#" data-view="pid-tuning">
                <span class="menu-icon">‚öôÔ∏è</span>
                <span>Strojenie PID</span>
            </a></li>
            <li><a href="#" data-view="calibration">
                <span class="menu-icon">üéØ</span>
                <span>Kalibracja</span>
            </a></li>
            <li><a href="#" data-view="autonomous">
                <span class="menu-icon">ü§ñ</span>
                <span>Sterowanie Autonomiczne</span>
            </a></li>
            <li><a href="#" data-view="autotuning">
                <span class="menu-icon">üéØ</span>
                <span>Auto-strojenie PID</span>
            </a></li>
            <li><a href="#" data-view="diagnostics">
                <span class="menu-icon">üîç</span>
                <span>Diagnostyka</span>
            </a></li>
            <li><a href="#" data-view="3d">
                <span class="menu-icon">üéÆ</span>
                <span>Model 3D</span>
            </a></li>
            <li><a href="#" data-view="settings">
                <span class="menu-icon">‚ö°</span>
                <span>Ustawienia</span>
            </a></li>
            <li><a href="#" id="loadEepromBtn">
                <span class="menu-icon">üìÇ</span>
                <span>Wczytaj EEPROM</span>
            </a></li>
            <li><a href="#" id="saveEepromBtn">
                <span class="menu-icon">üíæ</span>
                <span>Zapisz EEPROM</span>
            </a></li>
        </ul>
        <div class="sidebar-footer">
            <button id="themeToggle" class="theme-toggle">
                <span class="theme-icon">üåô</span>
                <span class="theme-label">Tryb Ciemny</span>
            </button>
        </div>
    </nav>

    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Right Panel Overlay -->
    <div id="panelRightOverlay" class="panel-right-overlay"></div>

    <!-- View Pager -->
    <div id="view-pager" class="view-pager">
        <div id="main-page" class="page main-visible">
            <!-- Main Content -->
            <main class="app-content">
                <!-- Dashboard View (Default) -->
                <section id="viewDashboard" class="view active">
            <!-- Connection Card -->
            <div class="card">
                <button id="connectBtn" class="btn btn-primary btn-large">
                    <span>Po≈ÇƒÖcz z Robotem</span>
                </button>
                <button id="openManualCorrectionPanel" class="btn btn-secondary" style="margin-left:10px;">Korekta</button>
            </div>

            <!-- Virtual Joystick -->
            <div class="card joystick-card">
                <h2 class="card-title">Sterowanie
                    <span class="tooltip-icon" data-tooltip="U≈ºywaj joysticka do kontroli ruchu robota. Prz√≥d/ty≈Ç kontroluje prƒôdko≈õƒá, lewo/prawo obr√≥t.">?</span>
                </h2>
                <div id="joystickContainer" class="joystick-container">
                    <canvas id="joystickCanvas"></canvas>
                </div>
            </div>

            <!-- Main Toggles -->
            <div class="card">
                <h2 class="card-title">Tryby Pracy</h2>
                <div class="toggle-group">
                    <div class="toggle-item">
                        <label for="balanceToggle" class="toggle-label">
                            <span>Balansowanie</span>
                            <span class="tooltip-icon" data-tooltip="W≈ÇƒÖcz, aby robot aktywnie utrzymywa≈Ç r√≥wnowagƒô pionowƒÖ.">?</span>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="balanceToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-item">
                        <label for="holdPositionToggle" class="toggle-label">
                            <span>Trzymaj Pozycjƒô</span>
                            <span class="tooltip-icon" data-tooltip="Robot bƒôdzie pr√≥bowa≈Ç pozostaƒá w miejscu, korygujƒÖc dryf.">?</span>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="holdPositionToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-item">
                        <label for="speedModeToggle" class="toggle-label">
                            <span>Tryb Prƒôdko≈õci</span>
                            <span class="tooltip-icon" data-tooltip="W≈ÇƒÖcz kontrolƒô prƒôdko≈õci zamiast kontroli kƒÖta pochylenia.">?</span>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="speedModeToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Telemetry -->
            <div class="card">
                <h2 class="card-title">Telemetria</h2>
                <div class="telemetry-grid">
                    <div class="telemetry-item">
                        <span class="telemetry-label">Pitch</span>
                        <span class="telemetry-value" id="pitchValue">0.0¬∞</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Roll</span>
                        <span class="telemetry-value" id="rollValue">0.0¬∞</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Yaw</span>
                        <span class="telemetry-value" id="yawValue">0.0¬∞</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Czas Pƒôtli</span>
                        <span class="telemetry-value" id="loopTimeValue">0 Œºs</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Enkoder Lewy</span>
                        <span class="telemetry-value" id="encoderLeftVal">0</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Enkoder Prawy</span>
                        <span class="telemetry-value" id="encoderRightVal">0</span>
                    </div>
                </div>
            </div>
            <div id="dashboard-right-panel" class="panel-right" style="display:none;">
                <div class="card">
                    <h3 class="card-title">Korekta rƒôczna (Pitch / Roll)</h3>
                    <div class="param-group">
                        <label for="manualPitchCorrectionInput">Pitch (¬∞)</label>
                        <div class="input-group">
                            <button id="pitchMinus" class="btn-minus">‚àí</button>
                            <input type="number" id="manualPitchCorrectionInput" value="0.0" step="0.1">
                            <button id="pitchPlus" class="btn-plus">+</button>
                        </div>
                        <div class="button-group">
                            <button id="manualPitchApplyBtn" class="btn btn-primary">Zastosuj</button>
                            <button id="manualPitchSetZeroBtn" class="btn btn-secondary">Ustaw 0</button>
                        </div>
                    </div>
                    <div class="param-group">
                        <label for="manualRollCorrectionInput">Roll (¬∞)</label>
                        <div class="input-group">
                            <button id="rollMinus" class="btn-minus">‚àí</button>
                            <input type="number" id="manualRollCorrectionInput" value="0.0" step="0.1">
                            <button id="rollPlus" class="btn-plus">+</button>
                        </div>
                        <div class="button-group">
                            <button id="manualRollApplyBtn" class="btn btn-primary">Zastosuj</button>
                            <button id="manualRollSetZeroBtn" class="btn btn-secondary">Ustaw 0</button>
                        </div>
                    </div>
                    <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:8px;">
                        <button id="closeManualCorrectionPanel" class="btn btn-secondary">Zamknij</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- PID Tuning View -->
        <section id="viewPidTuning" class="view">
            <div class="card">
                <h2 class="card-title">Strojenie PID</h2>
                
                <!-- PID Tabs -->
                <div class="tabs">
                    <button class="tab active" data-tab="balance">Balans</button>
                    <button class="tab" data-tab="speed">Prƒôdko≈õƒá</button>
                    <button class="tab" data-tab="position">Pozycja</button>
                    <button class="tab" data-tab="rotation">Obr√≥t</button>
                    <button class="tab" data-tab="heading">Kurs</button>
                </div>

                <!-- Balance PID Tab -->
                <div id="tabBalance" class="tab-content active">
                    <div class="accordion">
                        <button class="accordion-btn">Nastawy Podstawowe</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="balanceKp">
                                    Kp - Si≈Ça
                                    <span class="tooltip-icon" data-tooltip="Okre≈õla, jak mocno robot reaguje na bie≈ºƒÖcy b≈ÇƒÖd przechy≈Çu. Zbyt du≈ºa warto≈õƒá powoduje oscylacje.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceKp" value="95" min="0" max="500" step="0.1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="balanceKi">
                                    Ki - Korekta
                                    <span class="tooltip-icon" data-tooltip="Eliminuje d≈Çugotrwa≈Çy, sta≈Çy b≈ÇƒÖd. Czƒôsto nie jest potrzebny dla balansu.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceKi" value="0" min="0" max="10" step="0.01">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="balanceKd">
                                    Kd - T≈Çumienie
                                    <span class="tooltip-icon" data-tooltip="Dzia≈Ça jak amortyzator - przeciwdzia≈Ça szybkim zmianom kƒÖta i wyg≈Çadza ruch.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceKd" value="3.23" min="0" max="50" step="0.01">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion">
                        <button class="accordion-btn">Ustawienia Zaawansowane</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="balanceFilterAlpha">
                                    Filtr Pochodnej (%)
                                    <span class="tooltip-icon" data-tooltip="Wyg≈Çadza sygna≈Ç r√≥≈ºniczkujƒÖcy (Kd), redukujƒÖc wp≈Çyw szum√≥w z czujnika.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceFilterAlpha" value="100" min="1" max="100" step="1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="balanceIntegralLimit">
                                    Limit Integratora
                                    <span class="tooltip-icon" data-tooltip="Maksymalna warto≈õƒá, jakƒÖ mo≈ºe osiƒÖgnƒÖƒá suma ca≈ÇkujƒÖca (Ki).">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="balanceIntegralLimit" value="50" min="0" max="200" step="1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Speed PID Tab -->
                <div id="tabSpeed" class="tab-content">
                    <div class="accordion">
                        <button class="accordion-btn">Nastawy Podstawowe</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="speedKp">
                                    Kp - Reakcja
                                    <span class="tooltip-icon" data-tooltip="Kontroluje, jak mocno robot pochyla siƒô, aby osiƒÖgnƒÖƒá zadanƒÖ prƒôdko≈õƒá. Wy≈ºsza warto≈õƒá = szybsze przyspieszanie/zwalnianie, ale mo≈ºe powodowaƒá oscylacje prƒôdko≈õci. Zacznij od ma≈Çych warto≈õci (0.1-0.5) i zwiƒôkszaj stopniowo. Typowy zakres: 0.1-2.0.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="speedKp" value="0.0" min="0" max="10" step="0.01">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="speedKi">
                                    Ki - Eliminacja b≈Çƒôdu
                                    <span class="tooltip-icon" data-tooltip="Eliminuje sta≈Çy b≈ÇƒÖd prƒôdko≈õci (gdy robot jedzie ciƒÖgle trochƒô wolniej/szybciej ni≈º powinien). Czƒôsto wystarczy 0, ale je≈õli prƒôdko≈õƒá nie osiƒÖga docelowej warto≈õci, dodaj ma≈ÇƒÖ warto≈õƒá Ki (0.01-0.1). Zbyt wysoka warto≈õƒá powoduje oscylacje. Typowy zakres: 0-0.2.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="speedKi" value="0.0" min="0" max="1" step="0.001">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="speedKd">
                                    Kd - T≈Çumienie
                                    <span class="tooltip-icon" data-tooltip="Wyg≈Çadza zmiany prƒôdko≈õci, przeciwdzia≈Ça oscylacjom. Pomaga, gdy robot 'skacze' miƒôdzy r√≥≈ºnymi prƒôdko≈õciami. Zacznij od 0, dodaj (0.01-0.1) je≈õli prƒôdko≈õƒá oscyluje. Zbyt wysoka warto≈õƒá spowalnia reakcjƒô na zmiany. Typowy zakres: 0-0.5.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="speedKd" value="0.0" min="0" max="5" step="0.001">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="maxTargetAngle">
                                    Max. kƒÖt z PID Prƒôdko≈õci (st.)
                                    <span class="tooltip-icon" data-tooltip="Maksymalny kƒÖt, jaki PID prƒôdko≈õci mo≈ºe zadaƒá robotowi, aby osiƒÖgnƒÖƒá docelowƒÖ prƒôdko≈õƒá. Limit bezpiecze≈Ñstwa - zapobiega zbyt du≈ºemu pochyleniu. Wiƒôksza warto≈õƒá = szybsze przyspieszanie, ale wiƒôksze ryzyko upadku. Typowy zakres: 10-20¬∞.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="maxTargetAngle" value="15.0" min="1" max="45" step="0.5">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="speedDeadband">
                                    Strefa martwa (imp/s)
                                    <span class="tooltip-icon" data-tooltip="Je≈õli rzeczywista prƒôdko≈õƒá r√≥≈ºni siƒô od zadanej o mniej ni≈º ta warto≈õƒá, PID nie reaguje. Zapobiega ciƒÖg≈Çym mikro-korektom przy ma≈Çych b≈Çƒôdach, oszczƒôdza energiƒô i zmniejsza drgania. Typowy zakres: 3-15 imp/s.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="speedDeadband" value="5" min="0" max="50" step="1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="speedIntegralLimit">
                                    Limit Integratora
                                    <span class="tooltip-icon" data-tooltip="Maksymalna warto≈õƒá sumy ca≈ÇkujƒÖcej (Ki). Zapobiega 'wind-up' (rozregulowaniu) integratora. Istotne tylko gdy u≈ºywasz Ki > 0. Typowy zakres: 10-50.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="speedIntegralLimit" value="20" min="0" max="100" step="1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion">
                        <button class="accordion-btn">Ustawienia Zaawansowane</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="speedFilterAlpha">
                                    Filtr Pochodnej (%)
                                    <span class="tooltip-icon" data-tooltip="Wyg≈Çadza sygna≈Ç r√≥≈ºniczkujƒÖcy (Kd). 100% = brak filtrowania. Zmniejsz, je≈õli Kd wprowadza nerwowo≈õƒá. Typowy zakres: 60-90%.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="speedFilterAlpha" value="80" min="1" max="100" step="1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sign-toggle-group">
                        <label>Znak sprzƒô≈ºenia (Prƒôdko≈õƒá)</label>
                        <div id="speedSign" class="sign-toggle">
                            <button data-sign="1" class="active">+1</button>
                            <button data-sign="-1">-1</button>
                        </div>
                        <span class="sign-tooltip" data-tooltip="Odwr√≥ƒá znak sprzƒô≈ºenia pƒôtli prƒôdko≈õci (zmiana mo≈ºliwa tylko w trybie IDLE)">?</span>
                    </div>
                </div>

                <!-- Position PID Tab -->
                <div id="tabPosition" class="tab-content">
                    <div class="accordion">
                        <button class="accordion-btn">Nastawy Podstawowe</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="positionKp">
                                    Kp - Si≈Ça powrotu
                                    <span class="tooltip-icon" data-tooltip="Kontroluje, jak mocno robot dƒÖ≈ºy do powrotu do zadanej pozycji (funkcja 'trzymaj pozycjƒô'). Wy≈ºsza warto≈õƒá = silniejsza korekta, szybszy powr√≥t. Zbyt wysoka powoduje oscylacje wok√≥≈Ç pozycji docelowej. Zacznij od 0.5-2.0. Typowy zakres: 0.5-5.0.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="positionKp" value="0.0" min="0" max="20" step="0.1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="positionKi">
                                    Ki - Korekta
                                    <span class="tooltip-icon" data-tooltip="Usuwa sta≈Çe odchylenie od pozycji (gdy robot powoli 'dryfuje' mimo w≈ÇƒÖczonej funkcji trzymania pozycji). Czƒôsto nie jest potrzebny. Dodaj ma≈ÇƒÖ warto≈õƒá (0.001-0.01) tylko je≈õli robot systematycznie odje≈ºd≈ºa od pozycji. Typowy zakres: 0-0.05.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="positionKi" value="0.0" min="0" max="1" step="0.001">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="positionKd">
                                    Kd - Hamowanie
                                    <span class="tooltip-icon" data-tooltip="Hamuje ruch, gdy robot zbli≈ºa siƒô do pozycji docelowej - zapobiega 'przestrzeleniu'. Wy≈ºsza warto≈õƒá = p≈Çynniejsze, bardziej kontrolowane zatrzymanie, ale wolniejszy powr√≥t. Zacznij od 0.1-0.5. Typowy zakres: 0.1-2.0.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="positionKd" value="0.0" min="0" max="10" step="0.05">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="maxTargetSpeed">
                                    Max. prƒôdko≈õƒá z PID Pozycji (imp/s)
                                    <span class="tooltip-icon" data-tooltip="Maksymalna prƒôdko≈õƒá, jakƒÖ PID pozycji mo≈ºe zadaƒá podczas powrotu do punktu. Limit bezpiecze≈Ñstwa - zapobiega zbyt szybkiemu ruchowi przy du≈ºych odchyleniach. Wy≈ºsza warto≈õƒá = szybszy powr√≥t, ale wiƒôksze ryzyko przesterowania. Typowy zakres: 500-1500 imp/s.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="maxTargetSpeed" value="1000" min="100" max="4000" step="50">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="positionDeadband">
                                    Margines b≈Çƒôdu (imp.)
                                    <span class="tooltip-icon" data-tooltip="Je≈õli odchylenie od pozycji jest mniejsze ni≈º ta warto≈õƒá (w impulsach enkodera), PID pozycji nie reaguje. Robot 'akceptuje' to ma≈Çe odchylenie i nie pr√≥buje go korygowaƒá. Zapobiega ciƒÖg≈Çym mikro-ruchom. Typowy zakres: 10-30 imp.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="positionDeadband" value="15" min="0" max="100" step="1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="positionIntegralLimit">
                                    Limit Integratora
                                    <span class="tooltip-icon" data-tooltip="Maksymalna warto≈õƒá sumy ca≈ÇkujƒÖcej (Ki). Zapobiega 'wind-up' integratora. Istotne tylko gdy Ki > 0. Typowy zakres: 50-200.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="positionIntegralLimit" value="100" min="0" max="500" step="10">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion">
                        <button class="accordion-btn">Ustawienia Zaawansowane</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="positionFilterAlpha">
                                    Filtr Pochodnej (%)
                                    <span class="tooltip-icon" data-tooltip="Wyg≈Çadza sygna≈Ç r√≥≈ºniczkujƒÖcy (Kd). 100% = brak filtrowania. Zmniejsz do 70-90%, je≈õli hamowanie jest 'szarpane'. Typowy zakres: 70-95%.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="positionFilterAlpha" value="90" min="1" max="100" step="1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sign-toggle-group">
                        <label>Znak sprzƒô≈ºenia (Pozycja)</label>
                        <div id="positionSign" class="sign-toggle">
                            <button data-sign="1" class="active">+1</button>
                            <button data-sign="-1">-1</button>
                        </div>
                        <span class="sign-tooltip" data-tooltip="Odwr√≥ƒá znak sprzƒô≈ºenia pƒôtli pozycji (zmiana mo≈ºliwa tylko w trybie IDLE)">?</span>
                    </div>
                </div>

                <!-- Rotation PID Tab -->
                <div id="tabRotation" class="tab-content">
                    <div class="accordion">
                        <button class="accordion-btn">Nastawy Podstawowe</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="rotationKp">
                                    Kp - Si≈Ça obrotu
                                    <span class="tooltip-icon" data-tooltip="Kontroluje moc obrotu podczas automatycznego skrƒôtu o zadany kƒÖt. Wy≈ºsza warto≈õƒá = szybszy obr√≥t, ale ryzyko przesterowania (robot obraca siƒô za daleko). Zacznij od ma≈Çych warto≈õci (1-5) i zwiƒôkszaj stopniowo. Typowy zakres: 2-10.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="rotationKp" value="0.0" min="0" max="50" step="0.1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="rotationKd">
                                    Kd - T≈Çumienie
                                    <span class="tooltip-icon" data-tooltip="Hamuje obr√≥t, gdy robot zbli≈ºa siƒô do docelowego kƒÖta. Zapobiega oscylacjom wok√≥≈Ç pozycji docelowej. Wy≈ºsza warto≈õƒá = p≈Çynniejsze, bardziej kontrolowane zatrzymanie. Zacznij od 0.5-2.0. Typowy zakres: 0.5-5.0.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="rotationKd" value="0.0" min="0" max="20" step="0.1">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Heading PID Tab -->
                <div id="tabHeading" class="tab-content">
                    <div class="accordion">
                        <button class="accordion-btn">Nastawy Podstawowe</button>
                        <div class="accordion-content">
                            <div class="param-group">
                                <label for="headingKp">
                                    Kp - Si≈Ça korekty
                                    <span class="tooltip-icon" data-tooltip="Kontroluje, jak mocno robot koryguje odchylenie od zadanego kursu podczas jazdy prosto. Wy≈ºsza warto≈õƒá = mocniejsza korekta, robot jedzie bardziej 'po linii'. Zbyt wysoka mo≈ºe powodowaƒá 'zygzakowanie'. Zacznij od 0.5-2.0. Typowy zakres: 0.5-5.0.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="headingKp" value="0.0" min="0" max="10" step="0.05">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="headingKi">
                                    Ki - Precyzja
                                    <span class="tooltip-icon" data-tooltip="Usuwa systematyczne odchylenie kursu (gdy robot powoli 'skrƒôca' w jednƒÖ stronƒô mimo jazdy prosto). Dodaj ma≈ÇƒÖ warto≈õƒá (0.01-0.1) je≈õli robot ma tendencjƒô do odbijania w bok. Typowy zakres: 0-0.2.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="headingKi" value="0.0" min="0" max="1" step="0.005">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="headingKd">
                                    Kd - T≈Çumienie
                                    <span class="tooltip-icon" data-tooltip="Wyg≈Çadza korekty kursu, zapobiega 'szarpaniu' przy zmianach kierunku. Przydatne je≈õli robot nerwowo koryguje kurs. Zacznij od 0.05-0.2. Typowy zakres: 0.05-0.5.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="headingKd" value="0.0" min="0" max="5" step="0.01">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                            <div class="param-group">
                                <label for="rotationToPwmScale">
                                    Skala wyj≈õcia PID -> PWM
                                    <span class="tooltip-icon" data-tooltip="Konwertuje wyj≈õcie PID obrotu/kursu na komponent skrƒôtu (PWM). Zwiƒôksz je≈õli korekty kierunku sƒÖ za s≈Çabe, zmniejsz je≈õli robot 'przeostrza' lub oscyluje. Typowy zakres: 0.005 - 0.05.">?</span>
                                </label>
                                <div class="input-group">
                                    <button class="btn-minus">‚àí</button>
                                    <input type="number" id="rotationToPwmScale" value="0.01" min="0" max="1" step="0.001">
                                    <button class="btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sign-toggle-group">
                        <label>Znak sprzƒô≈ºenia (Balans)</label>
                        <div id="balanceSign" class="sign-toggle">
                            <button data-sign="1" class="active">+1</button>
                            <button data-sign="-1">-1</button>
                        </div>
                        <span class="sign-tooltip" data-tooltip="Odwr√≥ƒá znak sprzƒô≈ºenia pƒôtli balansu (zmiana mo≈ºliwa tylko w trybie IDLE)">?</span>
                    </div>
                <div class="button-group mt-3">
                    <button id="loadConfig" class="btn btn-secondary">Wczytaj z Robota</button>
                    <button id="saveConfig" class="btn btn-primary">Zapisz na Robocie</button>
                </div>

                <!-- Tuning Progress Panel -->
                <div id="tuning-progress-panel" class="card" style="display: none;">
                    <h3 class="card-title">Postƒôp Strojenia</h3>
                    <div class="progress-info">
                        <div class="progress-item">
                            <span class="progress-label">Metoda:</span>
                            <span class="progress-value" id="current-method">---</span>
                        </div>
                        <div class="progress-item">
                            <span class="progress-label">Iteracja:</span>
                            <span class="progress-value" id="current-iteration">0</span> / <span id="total-iterations">0</span>
                        </div>
                        <div class="progress-item">
                            <span class="progress-label">Najlepszy Fitness:</span>
                            <span class="progress-value" id="best-fitness">---</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
                    </div>
                    <div class="button-group">
                        <button id="pause-tuning" class="btn btn-warning">Pauza</button>
                        <button id="resume-tuning" class="btn btn-success" style="display: none;">Wzn√≥w</button>
                        <button id="stop-tuning" class="btn btn-danger">Zatrzymaj</button>
                    </div>
                </div>

                <!-- Best Parameters Display -->
                <div id="best-params-panel" class="card" style="display: none;">
                    <h3 class="card-title">Najlepsze Parametry</h3>
                    <div class="param-display">
                        <div class="param-item">
                            <span class="param-label">Kp:</span>
                            <span class="param-value" id="best-kp">---</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">Ki:</span>
                            <span class="param-value" id="best-ki">---</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">Kd:</span>
                            <span class="param-value" id="best-kd">---</span>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="apply-best-btn" class="btn btn-primary" disabled>Zastosuj Parametry</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Other Views (Calibration, Autonomous, Diagnostics, Settings) -->
        <section id="viewCalibration" class="view">
            <div class="card">
                <h2 class="card-title">Kalibracja</h2>
                <p class="info-text">Narzƒôdzia kalibracji bƒôdƒÖ dostƒôpne tutaj...</p>
            </div>
        </section>

        <section id="viewAutonomous" class="view">
            <div class="card">
                <h2 class="card-title">Sterowanie Autonomiczne</h2>
                
                <!-- Manual Autonomous Controls -->
                <div class="card">
                    <h3>Sterowanie Precyzyjne (D-Pad)</h3>
                    <div class="dpad-input-group">
                        <label for="dpadDistInput">Dystans (cm):</label>
                        <input type="number" id="dpadDistInput" value="20">
                    </div>
                    <div class="dpad-input-group">
                        <label for="dpadAngleInput">KƒÖt (st.):</label>
                        <input type="number" id="dpadAngleInput" value="90">
                    </div>
                    <div class="dpad-container">
                        <button id="dpad-up" class="dpad-btn" data-dpad="up">‚Üë</button>
                        <button id="dpad-left" class="dpad-btn" data-dpad="left">‚Üê</button>
                        <button id="dpad-stop" class="dpad-btn" data-dpad="stop">√ó</button>
                        <button id="dpad-right" class="dpad-btn" data-dpad="right">‚Üí</button>
                        <button id="dpad-down" class="dpad-btn" data-dpad="down">‚Üì</button>
                    </div>
                </div>

                <!-- Sequence Controls -->
                <div class="sequence-controls">
                    <div class="button-group">
                        <button id="add-sequence-step-btn" class="btn btn-secondary">Dodaj Krok</button>
                        <button id="run-sequence-btn" class="btn btn-primary">Uruchom Sekwencjƒô</button>
                        <button id="stop-sequence-btn" class="btn btn-danger" style="display: none;">Zatrzymaj</button>
                        <button id="clear-sequence-btn" class="btn btn-warning">Wyczy≈õƒá</button>
                    </div>
                </div>

                <!-- Sequence List -->
                <div class="sequence-list" id="sequence-list">
                    <!-- Sequence steps will be added here dynamically -->
                </div>

                <!-- Path Visualization -->
                <div class="card">
                    <h2 class="card-title">Wizualizacja ≈öcie≈ºki</h2>
                    <div id="path-visualization-container" class="path-visualization-container">
                        <canvas id="pathCanvas"></canvas>
                    </div>
                    <div class="button-group">
                        <button id="reset-path-btn" class="btn btn-secondary">Resetuj ≈öcie≈ºkƒô</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="viewAutotuning" class="view">
            <div class="card">
                <h2 class="card-title">Auto-strojenie PID</h2>
                
                <!-- Tuning Configuration -->
                <div class="tuning-config">
                    <div class="config-section">
                        <label for="tuning-loop-selector">üéØ Pƒôtla PID do strojenia:</label>
                        <select id="tuning-loop-selector">
                            <option value="balance">Pƒôtla Balansu</option>
                            <option value="speed">Pƒôtla Prƒôdko≈õci</option>
                            <option value="position">Pƒôtla Pozycji</option>
                        </select>
                        <button id="open-fitness-modal-btn">Konfiguruj Wagi</button>
                    </div>
                    
                    <div class="config-section">
                        <h4>üîç Przestrze≈Ñ Przeszukiwania</h4>
                        <div class="search-space-grid">
                            <div class="search-space-param">
                                <label for="search-kp-min">Kp Min:</label>
                                <input type="number" id="search-kp-min" value="40" step="0.1">
                            </div>
                            <div class="search-space-param">
                                <label for="search-kp-max">Kp Max:</label>
                                <input type="number" id="search-kp-max" value="50" step="0.1">
                            </div>
                            <div class="search-space-param">
                                <label for="search-ki-min">Ki Min:</label>
                                <input type="number" id="search-ki-min" value="0" step="0.01">
                            </div>
                            <div class="search-space-param">
                                <label for="search-ki-max">Ki Max:</label>
                                <input type="number" id="search-ki-max" value="0" step="0.01">
                            </div>
                            <div class="search-space-param">
                                <label for="search-kd-min">Kd Min:</label>
                                <input type="number" id="search-kd-min" value="0" step="0.01">
                            </div>
                            <div class="search-space-param">
                                <label for="search-kd-max">Kd Max:</label>
                                <input type="number" id="search-kd-max" value="5" step="0.01">
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h4>üß™ Parametry Testu</h4>
                        <label><input type="checkbox" id="test-with-impulse" checked> Test z impulsem (skok odpowiedzi)</label>
                        <label><input type="checkbox" id="include-ki-checkbox"> Uwzglƒôdnij strojenie Ki</label>
                    </div>
                </div>

                <!-- Tuning Methods Tabs -->
                <div class="tuning-methods">
                    <div class="method-tabs">
                        <button class="method-tab active" data-method="ga">üß¨ Algorytm Genetyczny</button>
                        <button class="method-tab" data-method="pso">üåÄ PSO</button>
                        <button class="method-tab" data-method="zn">üìä Ziegler-Nichols</button>
                    </div>
                    
                    <div class="method-content active" data-method="ga">
                        <div class="method-config">
                            <div><label for="ga-population">Rozmiar populacji:</label><input type="number" id="ga-population" value="10" min="5" max="100"></div>
                            <div><label for="ga-generations">Liczba pokole≈Ñ:</label><input type="number" id="ga-generations" value="10" min="5" max="100"></div>
                            <div><label for="ga-mutation">Wska≈∫nik mutacji (%):</label><input type="number" id="ga-mutation" value="10" min="0" max="100" step="1"></div>
                            <div><label for="ga-crossover">Wska≈∫nik krzy≈ºowania (%):</label><input type="number" id="ga-crossover" value="70" min="0" max="100" step="1"></div>
                            <div><label><input type="checkbox" id="ga-elitism" checked> Elitaryzm</label></div>
                        </div>
                    </div>
                    
                    <div class="method-content" data-method="pso">
                        <div class="method-config">
                            <div><label for="pso-particles">Liczba czƒÖstek:</label><input type="number" id="pso-particles" value="10" min="10" max="100"></div>
                            <div><label for="pso-iterations">Liczba iteracji:</label><input type="number" id="pso-iterations" value="10" min="10" max="100"></div>
                            <div><label for="pso-inertia">Waga bezw≈Çadno≈õci:</label><input type="number" id="pso-inertia" value="0.7" min="0" max="1" step="0.01"></div>
                            <div><label for="pso-cognitive">Waga poznawcza:</label><input type="number" id="pso-cognitive" value="1.5" min="0" max="3" step="0.1"></div>
                            <div><label for="pso-social">Waga spo≈Çeczna:</label><input type="number" id="pso-social" value="1.5" min="0" max="3" step="0.1"></div>
                        </div>
                    </div>
                    
                    <div class="method-content" data-method="zn">
                        <div class="method-config">
                            <div><label for="zn-amplitude">Amplituda przeka≈∫nika:</label><input type="number" id="zn-amplitude" value="2.0" min="0.5" max="10" step="0.5"></div>
                            <div><label for="zn-min-cycles">Minimalna liczba cykli:</label><input type="number" id="zn-min-cycles" value="3" min="2" max="10"></div>
                        </div>
                    </div>
                </div>

                <!-- Tuning Progress Panel -->
                <div id="tuning-progress-panel" class="card" style="display: none;">
                    <h3>üìä Postƒôp Optymalizacji</h3>
                    <div class="progress-info">
                        <div>Status: <span id="tuning-status-text">Oczekuje</span></div>
                        <div>Iteracja: <span id="current-iteration">0</span> / <span id="total-iterations">0</span></div>
                        <div>Pokolenie: <span id="current-generation">0</span> / <span id="ga-gen-total">0</span></div>
                        <div>Osobnik: <span id="current-individual">0</span> / <span id="population-size">0</span></div>
                        <div>Parametry: Kp: <span id="current-kp">---</span> Ki: <span id="current-ki">---</span> Kd: <span id="current-kd">---</span></div>
                        <div>Fitness: <span id="current-fitness">---</span></div>
                    </div>
                    <canvas id="current-telemetry-chart" height="80"></canvas>
                    <div id="fitness-chart-container"><canvas id="fitness-chart"></canvas></div>
                    
                    <div class="current-best">
                        <h4>üèÜ Najlepsze Znalezione Parametry</h4>
                        <div class="current-best-grid">
                            <div><strong>Kp:</strong> <span id="best-kp">---</span></div>
                            <div><strong>Ki:</strong> <span id="best-ki">---</span></div>
                            <div><strong>Kd:</strong> <span id="best-kd">---</span></div>
                            <div><strong>Fitness:</strong> <span id="best-fitness">---</span></div>
                        </div>
                        <button id="apply-best-btn" disabled>Zastosuj Najlepsze</button>
                    </div>
                    
                    <div class="recent-results">
                        <h4>üïí Ostatnie 5 pr√≥b</h4>
                        <div id="recent-results-list">Brak danych.</div>
                        <button id="open-tuning-history-btn">üìú Historia i Eksport</button>
                    </div>
                </div>

                <!-- Tuning Controls -->
                <div class="tuning-controls">
                    <button id="start-tuning-btn">üöÄ Rozpocznij Strojenie</button>
                    <button id="pause-tuning-btn" disabled>‚è∏Ô∏è Pauza</button>
                    <button id="resume-tuning-btn" style="display:none;" disabled>‚ñ∂Ô∏è Wzn√≥w</button>
                    <button id="stop-tuning-btn" disabled>‚èπÔ∏è Zatrzymaj</button>
                </div>
            </div>
        </section>

        <!-- Diagnostics View -->
        <section id="viewDiagnostics" class="view">
            <div class="card">
                <h2 class="card-title">Diagnostyka</h2>
                
                <!-- Signal Analyzer -->
                <div class="signal-analyzer">
                    <h3>Wykres Sygna≈Ç√≥w</h3>
                    <div class="chart-hints">
                        <strong>üí° Wskaz√≥wki:</strong> 
                        Ctrl+Scroll dla zoom | Ctrl+PrzeciƒÖgnij dla przewijania | Shift+PrzeciƒÖgnij dla zaznaczenia zakresu
                    </div>
                    <div class="chart-controls" id="signalChartControls">
                        <!-- Checkboxes will be added here dynamically -->
                    </div>
                    <canvas id="signalAnalyzerChart" class="signal-canvas"></canvas>
                    <div class="button-group">
                        <button id="pauseChartBtn" class="btn btn-secondary">Pauza</button>
                        <button id="resumeChartBtn" class="btn btn-secondary" style="display: none;">Wzn√≥w</button>
                        <button id="cursorABBtn" class="btn btn-secondary">Kursory A/B</button>
                        <button id="exportCsvBtn" class="btn btn-primary">Eksport CSV</button>
                        <button id="exportRangeCsvBtn" class="btn btn-primary">Eksport Zakresu CSV</button>
                        <button id="resetZoomBtn" class="btn btn-secondary">Reset Zoom</button>
                        <button id="exportPngBtn" class="btn btn-primary">Eksport PNG</button>
                    </div>
                </div>

                <!-- Cursor Info -->
                <div class="cursor-info" id="cursorInfo" style="display: none;">
                    <div class="cursor-row">
                        <div class="cursor-item">
                            <span class="cursor-label">Kursor A:</span>
                            <span class="cursor-value" id="cursorAX">---</span>
                            <span class="cursor-value" id="cursorAY">---</span>
                        </div>
                        <div class="cursor-item">
                            <span class="cursor-label">Kursor B:</span>
                            <span class="cursor-value" id="cursorBX">---</span>
                            <span class="cursor-value" id="cursorBY">---</span>
                        </div>
                    </div>
                    <div class="cursor-row">
                        <div class="cursor-item">
                            <span class="cursor-label">ŒîT:</span>
                            <span class="cursor-value" id="cursorDeltaT">---</span>
                        </div>
                        <div class="cursor-item">
                            <span class="cursor-label">ŒîPitch:</span>
                            <span class="cursor-value" id="cursorDeltaYPitch">---</span>
                        </div>
                        <div class="cursor-item">
                            <span class="cursor-label">ŒîSpeed:</span>
                            <span class="cursor-value" id="cursorDeltaYSpeed">---</span>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="cursorABBtn" class="btn btn-secondary">Kursory A/B</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3D Visualization View -->
        <section id="view3D" class="view">
            <div class="card">
                <h2 class="card-title">Model 3D Robota</h2>
                <div id="robot3d-container" class="robot-3d-container"></div>
                <div class="robot-3d-controls">
                    <div class="control-row">
                        <span class="control-label">Perspektywa Robota</span>
                        <label class="switch">
                            <input type="checkbox" id="robotPerspectiveCheckbox">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <div class="robot-3d-info">
                    <div class="robot-3d-metrics">
                        <div><strong>Przechyl (Pitch):</strong> <span id="robot3d-pitch">0.0¬∞</span></div>
                        <div><strong>Przechyl (Roll):</strong> <span id="robot3d-roll">0.0¬∞</span></div>
                        <div><strong>Obrot k√≥≈Ç:</strong> <span id="robot3d-wheel-speed">0 obr/min</span></div>
                        <div><strong>Pozycja X:</strong> <span id="robot3d-position-x">0.0 cm</span></div>
                        <div><strong>Pozycja Z:</strong> <span id="robot3d-position-z">0.0 cm</span></div>
                    </div>
                </div>
                <div class="button-group">
                    <button id="reset3DView" class="btn btn-secondary">Resetuj Widok</button>
                    <button id="toggle3DAnimation" class="btn btn-secondary">W≈Ç./Wy≈Ç. Animacjƒô</button>
                    <button id="toggle3DMovement" class="btn btn-secondary">Start/Stop Ruchu</button>
                    <button id="modelMappingBtn3D" class="btn btn-secondary">Mapowanie Modelu 3D</button>
                </div>
            </div>
        </section>

        <section id="viewSettings" class="view">
            <div class="card">
                <h2 class="card-title">Ustawienia</h2>
                
                <!-- Joystick Settings -->
                <div class="accordion">
                    <button class="accordion-btn">Strojenie Joysticka</button>
                    <div class="accordion-content">
                        <div class="param-group">
                            <label for="joystickSensitivityInput">Czu≈Ço≈õƒá Globalna (%)
                                <span class="tooltip-icon" data-tooltip="Globalny mno≈ºnik dla wszystkich warto≈õci z joysticka. Ustawienie 100% oznacza pe≈ÇnƒÖ czu≈Ço≈õƒá - robot reaguje maksymalnie na ruchy joysticka. Zmniejsz do 50-70%, je≈õli robot jest zbyt nerwowy lub reaguje zbyt gwa≈Çtownie. Przydatne podczas nauki sterowania lub w ciasnych przestrzeniach. Typowy zakres: 60-100%.">?</span>
                            </label>
                            <div class="numeric-input-wrapper">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="joystickSensitivityInput" value="100" min="10" max="100" step="5">
                                <button class="btn-plus">+</button>
                            </div>
                        </div>
                        <div class="param-group">
                            <label for="expoJoystickInput">Expo Joysticka (%)
                                <span class="tooltip-icon" data-tooltip="Krzywa wyk≈Çadnicza (expo) zmienia charakterystykƒô odpowiedzi joysticka. Przy 0% odpowied≈∫ jest liniowa. Zwiƒôkszenie warto≈õci sprawia, ≈ºe przy ma≈Çych wychyleniach robot reaguje ≈Çagodniej (wiƒôksza precyzja), a przy du≈ºych wychyleniach normalnie. Warto≈õƒá 30-50% zapewnia dobrƒÖ r√≥wnowagƒô miƒôdzy precyzjƒÖ a responsywno≈õciƒÖ. Typowy zakres: 0-50%.">?</span>
                            </label>
                            <div class="input-group">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="expoJoystickInput" value="0" min="0" max="90" step="1">
                                <button class="btn-plus">+</button>
                            </div>
                        </div>
                        <div class="param-group">
                            <label for="maxSpeedJoystickInput">Max. prƒôdko≈õƒá (imp/s)
                                <span class="tooltip-icon" data-tooltip="Maksymalna prƒôdko≈õƒá zadana w trybie prƒôdko≈õci przy pe≈Çnym wychyleniu joysticka do przodu/ty≈Çu. Wy≈ºsza warto≈õƒá = szybszy robot. Dla bezpiecznej nauki zacznij od 500-800 imp/s. Dla sportowej jazdy mo≈ºesz zwiƒôkszyƒá do 1500-2500 imp/s. Uwaga: zbyt wysoka warto≈õƒá mo≈ºe powodowaƒá utratƒô balansu! Typowy zakres: 500-1500 imp/s.">?</span>
                            </label>
                            <div class="input-group">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="maxSpeedJoystickInput" class="config-value" value="800" min="200" max="4000" step="100">
                                <button class="btn-plus">+</button>
                            </div>
                        <div class="param-group">
                            <label for="maxAccelJoystickInput">Max. przyspieszenie (imp/s^2)
                                <span class="tooltip-icon" data-tooltip="Maksymalna zmiana zadanej prƒôdko≈õci na sekundƒô (imp/s^2). Ogranicza przyspieszenie przy sterowaniu joystickiem, co poprawia stabilno≈õƒá.">?</span>
                            </label>
                            <div class="input-group">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="maxAccelJoystickInput" class="config-value" value="200" min="0" max="5000" step="10">
                                <button class="btn-plus">+</button>
                            </div>
                        </div>
                        </div>
                        <div class="param-group">
                            <label for="joystickAngleSensitivityInput">Czu≈Ço≈õƒá KƒÖta (st.)
                                <span class="tooltip-icon" data-tooltip="Maksymalny kƒÖt pochylenia zadany w trybie kƒÖta przy pe≈Çnym wychyleniu joysticka. Mniejsza warto≈õƒá (5-8¬∞) = ≈Çagodniejsze przyspieszenie, bardziej przewidywalne zachowanie. Wiƒôksza warto≈õƒá (12-20¬∞) = agresywniejsze przyspieszenie, szybsza reakcja. Rozpocznij od 8-10¬∞ i dostosuj do swoich preferencji. Typowy zakres: 6-15¬∞.">?</span>
                            </label>
                            <div class="input-group">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="joystickAngleSensitivityInput" value="10" min="1" max="30" step="0.5">
                                <button class="btn-plus">+</button>
                            </div>
                        </div>
                        <div class="param-group">
                            <label for="turnFactorInput">Czu≈Ço≈õƒá Skrƒôtu (%)
                                <span class="tooltip-icon" data-tooltip="Kontroluje, jak szybko robot obraca siƒô w miejscu przy wychyleniu joysticka w poziomie. Mniejsza warto≈õƒá (15-25%) = powolne, p≈Çynne skrƒôty. Wiƒôksza warto≈õƒá (40-60%) = szybkie, ostre skrƒôty. Za wysoka warto≈õƒá mo≈ºe powodowaƒá utratƒô balansu podczas obrotu. Typowy zakres: 20-40%.">?</span>
                            </label>
                            <div class="input-group">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="turnFactorInput" value="25" min="0" max="100" step="5">
                                <button class="btn-plus">+</button>
                            </div>
                        </div>
                        <div class="param-group">
                            <label for="joystickDeadzoneInput">Strefa Martwa (%)
                                <span class="tooltip-icon" data-tooltip="Obszar wok√≥≈Ç ≈õrodka joysticka, w kt√≥rym ruch jest ignorowany. Przydatne, je≈õli joystick 'dryfuje' sam z siebie lub chcesz uniknƒÖƒá przypadkowych mikroruch√≥w. Warto≈õƒá 5-10% usuwa drobne dr≈ºenia bez utraty czu≈Ço≈õci. Typowy zakres: 0-15%.">?</span>
                            </label>
                            <div class="input-group">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="joystickDeadzoneInput" value="0" min="0" max="50" step="1">
                                <button class="btn-plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Joystick Mapping (moved to modal) -->
                <div class="accordion">
                    <button class="accordion-btn active">Mapowanie Gamepada</button>
                    <div class="accordion-content active">
                        <div class="joystick-mapping">
                            <div class="mapping-section">
                                <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;">
                                    <div style="flex:1; min-width:220px;">
                                        <label style="font-weight:600; display:block;">Osie Sterowania</label>
                                        <div class="axis-mapping">
                                            <div class="axis-item">
                                                <label>O≈õ X (Lewo/Prawo):</label>
                                                <select id="axis-x-select">
                                                    <option value="-1">Brak</option>
                                                </select>
                                                <label style="margin-left:8px;"><input type="checkbox" id="invert-x"> Inwersja</label>
                                            </div>
                                            <div class="axis-item">
                                                <label>O≈õ Y (Prz√≥d/Ty≈Ç):</label>
                                                <select id="axis-y-select">
                                                    <option value="-1">Brak</option>
                                                </select>
                                                <label style="margin-left:8px;"><input type="checkbox" id="invert-y"> Inwersja</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="min-width:160px; display:flex; gap:8px; justify-content:flex-end;">
                                        <button id="open-gamepad-modal-btn" class="btn btn-secondary">Otw√≥rz Mapowanie</button>
                                    </div>
                                </div>
                            </div>
                            <div class="mapping-section" style="margin-top:12px; color:var(--text-secondary); font-size:0.95rem;">
                                <div class="axis-mapping-summary">Mapowanie przycisk√≥w dostƒôpne w wyskakujƒÖcym oknie (u≈ºyj przycisku "Otw√≥rz Mapowanie").</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hardware Settings -->
                <div class="accordion">
                    <button class="accordion-btn">Parametry Sprzƒôtowe</button>
                    <div class="accordion-content">
                        <div class="param-group">
                            <label for="wheelDiameterInput">≈örednica Ko≈Ça (cm)
                                <span class="tooltip-icon" data-tooltip="≈örednica ko≈Ça robota w centymetrach. Parametr kluczowy dla obliczania prƒôdko≈õci i pokonanego dystansu. Zmierz dok≈Çadnie ≈õrednicƒô od krawƒôdzi do krawƒôdzi przez ≈õrodek ko≈Ça. Wiƒôksze ko≈Ça = wiƒôksza prƒôdko≈õƒá przy tych samych obrotach silnika. Typowy zakres: 6-12 cm.">?</span>
                            </label>
                            <div class="input-group">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="wheelDiameterInput" value="8.2" min="1" max="30" step="0.1">
                                <button class="btn-plus">+</button>
                            </div>
                        </div>
                        <div class="param-group">
                            <label for="trackWidthInput">Rozstaw K√≥≈Ç (cm)
                                <span class="tooltip-icon" data-tooltip="Odleg≈Ço≈õƒá miƒôdzy ≈õrodkami obu k√≥≈Ç (szeroko≈õƒá toru). Wp≈Çywa na obliczenia obrotu - szerszy rozstaw wymaga wiƒôkszej r√≥≈ºnicy prƒôdko≈õci k√≥≈Ç do wykonania tego samego skrƒôtu. Zmierz odleg≈Ço≈õƒá miƒôdzy ≈õrodkami osi k√≥≈Ç. Typowy zakres: 10-20 cm.">?</span>
                            </label>
                            <div class="input-group">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="trackWidthInput" value="12.5" min="5" max="50" step="0.1">
                                <button class="btn-plus">+</button>
                            </div>
                        </div>
                        <div class="param-group">
                            <label for="encoderPprInput">Impulsy na Obr√≥t (PPR)
                                <span class="tooltip-icon" data-tooltip="Liczba impuls√≥w enkodera na jeden pe≈Çny obr√≥t ko≈Ça. Zale≈ºy od rozdzielczo≈õci enkodera i przek≈Çadni (je≈õli jest). Warto≈õƒá ta wp≈Çywa na dok≈Çadno≈õƒá pomiaru prƒôdko≈õci i pozycji. Wy≈ºsza warto≈õƒá = wiƒôksza precyzja. Sprawd≈∫ specyfikacjƒô swojego enkodera i przek≈Çadni. Typowy zakres: 300-2000 PPR.">?</span>
                            </label>
                            <div class="input-group">
                                <button class="btn-minus">‚àí</button>
                                <input type="number" id="encoderPprInput" value="820" min="100" max="5000" step="10">
                                <button class="btn-plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- IMU Settings -->
                <div class="accordion">
                    <button class="accordion-btn">Strojenie IMU</button>
                    <div class="accordion-content">
                        <div class="param-group">
                            <label for="useMadgwickFilterInput">
                                U≈ºyj filtra Madgwicka
                                <span class="tooltip-icon" data-tooltip="W≈ÇƒÖcz w≈ÇasnƒÖ fuzjƒô IMU z filtrem Madgwicka zamiast wbudowanego filtra BNO055. Mo≈ºe poprawiƒá stabilno≈õƒá w trudnych warunkach.">?</span>
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="useMadgwickFilterInput">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="param-group">
                            <label for="madgwickBetaInput">
                                Beta (filtr Madgwicka)
                                <span class="tooltip-icon" data-tooltip="Wsp√≥≈Çczynnik ufno≈õci w dane ≈ºyroskopu. Wy≈ºsze warto≈õci = szybsza reakcja na zmiany, ale wiƒôksza wra≈ºliwo≈õƒá na szumy. Typowy zakres: 0.01-1.0. Domy≈õlnie: 0.1">?</span>
                            </label>
                            <div class="input-group">
                                <button id="madgwickBetaMinus" class="btn-minus">‚àí</button>
                                <input type="number" id="madgwickBetaInput" value="0.1" min="0.001" max="2.0" step="0.01">
                                <button id="madgwickBetaPlus" class="btn-plus">+</button>
                            </div>
                        </div>
                        <div class="param-group">
                            <label for="madgwickZetaInput">
                                Zeta (filtr Madgwicka)
                                <span class="tooltip-icon" data-tooltip="Wsp√≥≈Çczynnik korekcji dryftu ≈ºyroskopu. Wy≈ºsze warto≈õci = lepsza korekcja dryftu, ale wolniejsza reakcja. Typowy zakres: 0-1.0. Domy≈õlnie: 0.0">?</span>
                            </label>
                            <div class="input-group">
                                <button id="madgwickZetaMinus" class="btn-minus">‚àí</button>
                                <input type="number" id="madgwickZetaInput" value="0.0" min="0.0" max="1.0" step="0.01">
                                <button id="madgwickZetaPlus" class="btn-plus">+</button>
                            </div>
                        </div>
                        <div class="param-group">
                            <label for="magnetometerEnabledInput">
                                W≈ÇƒÖcz magnetometr
                                <span class="tooltip-icon" data-tooltip="W≈ÇƒÖcz magnetometr dla 9-osiowej fuzji IMU (NDOF). Wy≈ÇƒÖcz je≈õli magnetometr jest zak≈Ç√≥cany (np. przez silniki).">?</span>
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="magnetometerEnabledInput" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <hr style="border-color:#2a2a35;">
                        <div class="imu-tuning-chart-container">
                            <h4>Wykres Strojenia IMU</h4>
                            <canvas id="imuTuningChart" height="280" style="max-width:100%; width:100%"></canvas>
                            <div style="display:flex; align-items:center; justify-content:space-between; margin-top:8px; gap:12px;">
                                <div style="flex:1;">
                                    <label for="imuTuningTelemetryToggle" style="font-weight:600;">Telemetry: surowy kƒÖt (akcelerometr) vs filtr Madgwicka</label>
                                    <div style="font-size:0.85em; color:var(--text-secondary);">U≈ºyj tej opcji aby w≈ÇƒÖczyƒá/wy≈ÇƒÖczyƒá przesy≈Çanie dedykowanej telemetrii IMU do strojenia.</div>
                                </div>
                                <label class="switch" style="margin-left:auto;">
                                    <input type="checkbox" id="imuTuningTelemetryToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PWM Calibration (min PWM autotune) -->
                <div class="accordion">
                    <button class="accordion-btn">Kalibracja PWM Silnik√≥w</button>
                    <div class="accordion-content">
                        <div class="pwm-info"> <strong>Info:</strong> U≈ºyj przycisku <strong>Auto</strong>, aby automatycznie znale≈∫ƒá prog startowy silnika, lub <strong>Testuj</strong>, aby sprawdziƒá rƒôcznie wpisanƒÖ warto≈õƒá. <strong>UWAGA:</strong> Przed testem podnie≈õ robota, aby ko≈Ça mog≈Çy siƒô swobodnie obracaƒá!</div>
                        <div class="param-group">
                            <label for="pwmTuneStartInput">Rozpocznij auto-szukanie od PWM</label>
                            <div class="input-group">
                                <button id="pwmTuneStartMinus" class="btn-minus">‚àí</button>
                                <input type="number" id="pwmTuneStartInput" value="1200" min="1" max="2047" step="1">
                                <button id="pwmTuneStartPlus" class="btn-plus">+</button>
                            </div>
                        </div>
                        <hr>
                        <div class="param-group manual-tune-row" data-motor="left" data-direction="fwd">
                            <label>Lewy (Prz√≥d)</label>
                            <div class="input-group">
                                <button class="btn-minus tune-minus">‚àí</button>
                                <input type="number" id="minPwmLeftFwdInput" class="tune-input" value="1200" min="0" max="2047" step="1">
                                <button class="btn-plus tune-plus">+</button>
                            </div>
                            <div class="button-group">
                                <button class="btn test-btn">Testuj</button>
                                <button class="btn stop-btn">Stop</button>
                                <button class="btn auto-btn">Auto</button>
                            </div>
                        </div>

                        <div class="param-group manual-tune-row" data-motor="left" data-direction="bwd">
                            <label>Lewy (Ty≈Ç)</label>
                            <div class="input-group">
                                <button class="btn-minus tune-minus">‚àí</button>
                                <input type="number" id="minPwmLeftBwdInput" class="tune-input" value="1200" min="0" max="2047" step="1">
                                <button class="btn-plus tune-plus">+</button>
                            </div>
                            <div class="button-group">
                                <button class="btn test-btn">Testuj</button>
                                <button class="btn stop-btn">Stop</button>
                                <button class="btn auto-btn">Auto</button>
                            </div>
                        </div>

                        <div class="param-group manual-tune-row" data-motor="right" data-direction="fwd">
                            <label>Prawy (Prz√≥d)</label>
                            <div class="input-group">
                                <button class="btn-minus tune-minus">‚àí</button>
                                <input type="number" id="minPwmRightFwdInput" class="tune-input" value="1200" min="0" max="2047" step="1">
                                <button class="btn-plus tune-plus">+</button>
                            </div>
                            <div class="button-group">
                                <button class="btn test-btn">Testuj</button>
                                <button class="btn stop-btn">Stop</button>
                                <button class="btn auto-btn">Auto</button>
                            </div>
                        </div>

                        <div class="param-group manual-tune-row" data-motor="right" data-direction="bwd">
                            <label>Prawy (Ty≈Ç)</label>
                            <div class="input-group">
                                <button class="btn-minus tune-minus">‚àí</button>
                                <input type="number" id="minPwmRightBwdInput" class="tune-input" value="1200" min="0" max="2047" step="1">
                                <button class="btn-plus tune-plus">+</button>
                            </div>
                            <div class="button-group">
                                <button class="btn test-btn">Testuj</button>
                                <button class="btn stop-btn">Stop</button>
                                <button class="btn auto-btn">Auto</button>
                            </div>
                        </div>

                        <div class="button-group" style="margin-top:12px;">
                            <button id="manualTuneStopAll" class="btn btn-danger">ZATRZYMAJ WSZYSTKIE SILNIKI</button>
                        </div>
                        <div class="button-group" style="margin-top:8px;">
                            <button id="sensorMappingBtnSettings" class="btn btn-secondary">Mapowanie Czujnika</button>
                        </div>
                    </div>
                </div>

                <!-- IMU Calibration -->
                <div class="accordion">
                    <button class="accordion-btn">Kalibracja IMU</button>
                    <div class="accordion-content">
                        <div class="button-group">
                            <button id="calibrateMpuBtnSettings" class="btn btn-secondary">Kalibracja IMU</button>
                            <button id="calibrateZeroPointBtnSettings" class="btn btn-secondary">Znajd≈∫ Pion Automatycznie</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
        </div>
        <div id="dynamic-page" class="page dynamic-hidden">
            <!-- Druga strona - sta≈Ça tre≈õƒá testowa -->
            <div class="card" style="text-align: center; padding: 2rem; margin: 1rem;">
                <h2>Druga strona - test</h2>
                <p>To jest druga strona pagera.</p>
                <p>Je≈õli widzisz ten tekst, strona dzia≈Ça prawid≈Çowo.</p>
                <p>Kostka siƒô obraca z ruchem palca.</p>
                <button onclick="switchToPage(1)" class="btn btn-secondary" style="margin-top: 1rem;">Wr√≥ƒá do strony g≈Ç√≥wnej</button>
            </div>
        </div>
    </div>

    <!-- Collapsible Log Sheet -->
    <div id="logSheet" class="log-sheet">
        <div class="log-header" id="logHeader">
            <div class="log-title-area">
                <h3 class="log-title">Logi Systemowe</h3>
                <span class="log-badge" id="logBadge">0</span>
            </div>
            <div class="log-controls">
                <label class="log-autoscroll">
                    <input type="checkbox" id="logAutoscroll" checked>
                    <span>Auto-scroll</span>
                </label>
                <button id="clearLogs" class="btn-icon" title="Wyczy≈õƒá logi">üóëÔ∏è</button>
                <button id="logToggle" class="btn-icon log-toggle-icon" aria-label="Rozwi≈Ñ/zwi≈Ñ logi">
                    <span class="chevron">‚ñ≤</span>
                </button>
            </div>
        </div>
        <div class="log-content" id="logContent">
            <div id="logMessages"></div>
        </div>
    </div>

    <!-- Load Scripts -->
    <!-- Modal: Konfiguracja Fitness -->
    <div id="fitness-modal" class="modal-backdrop" style="display:none;">
        <div class="modal-content" style="max-width:480px;">
            <h2>Konfiguracja Fitness (Rozdziel 100 punkt√≥w)</h2>
            <div style="display:flex; gap:10px; flex-direction:column;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <label for="ga-weight-itae">ITAE</label>
                    <input type="number" id="ga-weight-itae" min="0" max="100" value="50" style="width:110px;">
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <label for="ga-weight-overshoot">Przeregulowanie</label>
                    <input type="number" id="ga-weight-overshoot" min="0" max="100" value="30" style="width:110px;">
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <label for="ga-weight-control-effort">SSE / Kontrola</label>
                    <input type="number" id="ga-weight-control-effort" min="0" max="100" value="20" style="width:110px;">
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; font-weight:bold; color:var(--accent-primary);">
                    <div>Pozosta≈Ço:</div>
                    <div id="ga-weight-remaining">0</div>
                </div>
                <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:8px;">
                    <button id="close-fitness-modal" style="background:var(--accent-error);">Zamknij</button>
                    <button id="apply-fitness-btn" style="background:var(--accent-secondary);" disabled>Zastosuj Wagi</button>
                </div>
            </div>
                <!-- Modal: Mapowanie Gamepada (top-level) -->
                <div id="gamepad-mapping-modal" class="modal-backdrop" style="display:none;">
                    <div class="modal-content" style="max-width:560px;">
                        <h2>Mapowanie Gamepada <span class="help-icon" title="Przypisz akcje do przycisk√≥w gamepada">?</span></h2>
                        <div class="mapping-list" id="gamepad-mapping-list" style="margin-top:8px;">
                            <!-- dynamic content will be rendered here -->
                        </div>
                        <div style="display:flex; gap:8px; margin-top:12px; justify-content:flex-end; flex-wrap:wrap;">
                            <button id="start-mapping-btn" class="btn btn-primary">Rozpocznij Mapowanie</button>
                            <button id="save-mapping-btn" class="btn btn-secondary">Zapisz Mapowanie</button>
                            <button id="load-mapping-btn" class="btn btn-secondary">Wczytaj Mapowanie</button>
                            <button id="close-modal-btn" class="btn btn-secondary">Zamknij</button>
                        </div>
                        <div style="display:flex; gap:10px; margin-top:12px; justify-content:space-between;">
                            <div id="gamepadStatus" style="font-weight:600; color:var(--text-secondary);">Brak</div>
                        </div>
                    </div>
                </div>
        </div>
    </div>
    <!-- Sensor mapping modal -->
    <div id="sensor-mapping-modal" class="modal-backdrop" style="display:none;">
        <div class="modal-content">
            <h2>Mapowanie Czujnika (Orientacja) <span class="help-icon" id="sensorMappingHelp" title="Poka≈º/ukryj szczeg√≥≈ÇowƒÖ pomoc">?</span></h2>
            <div id="sensorMappingHelpText" class="help-text" style="margin-bottom:10px;" aria-hidden="true">
                <strong>Cel:</strong> Dopasowanie fizycznego monta≈ºu IMU do oczekiwanych osi sterowania robota.<br>
                <strong>Kroki:</strong> (1) Pozycja pionowa referencyjna. (2) Obr√≥t poziomy ‚â• 90¬∞. (3) Zapis korekcji.<br>
                <strong>Wp≈Çyw:</strong> Dzia≈Ça na wewnƒôtrzne wektory (akcelerometr/≈ºyroskop) u≈ºywane przez PID. Nie zmienia wizualizacji 3D (oddzielne mapowanie modelu).<br>
                <strong>Wymagane:</strong> Kalibracja IMU (System=3) dla najlepszej dok≈Çadno≈õci.
            </div>
            <div id="sensorWizardStepInfo" style="margin:6px 0; font-size:12px; color:#aaa;">Krok <span id="sensorWizardStepNo">1</span>/3</div>
            <div id="sensorWizardText" style="text-align:left; font-size:0.95em; line-height:1.5; background:#101014; border:1px solid #2a2a35; padding:12px; border-radius:8px;">
                <!-- dynamic content -->
            </div>
            <div id="sensorWizardHint" style="margin-top:8px; font-size:0.85em; color:#bbb;"> </div>
            <div id="sensorWizardProgress" style="margin-top:12px; font-family:monospace; background:#111; border:1px solid #333; border-radius:6px; padding:8px; text-align:left;">
                [ ] Pion | [ ] Rotacja ‚â• 90¬∞ | [ ] Zapis
            </div>
            <div class="sensor-mapping-wrapper" style="display:flex; gap:10px; margin-top:12px; align-items:flex-start;">
                <div id="sensor-mapping-preview" class="sensor-mapping-preview" style="flex:1; min-width:250px; height:200px; background:#000; border-radius:6px; overflow:hidden;"></div>
                <div class="sensor-mapping-controls" style="width:320px; display:flex; flex-direction:column; gap:8px;">
                    <div style="display:flex; justify-content:space-between; gap:6px;">
                        <div>
                            <div>Pitch (Cube): <span id="modal-pitch-display">0.0¬∞</span></div>
                            <div style="font-size:0.8em; color:#9fa;">Telemetry: <span id="modal-pitch-telemetry">0.0¬∞</span></div>
                        </div>
                        <div>
                            <div>Roll (Cube): <span id="modal-roll-display">0.0¬∞</span></div>
                            <div style="font-size:0.8em; color:#9fa;">Telemetry: <span id="modal-roll-telemetry">0.0¬∞</span></div>
                        </div>
                        <div>
                            <div>Yaw (Cube): <span id="modal-yaw-display">0.0¬∞</span></div>
                            <div style="font-size:0.8em; color:#9fa;">Telemetry: <span id="modal-yaw-telemetry">0.0¬∞</span></div>
                        </div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">Pitch</div><button id="pitchMinus90Btn">-90¬∞</button><button id="pitchPlus90Btn">+90¬∞</button></div>
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">Roll</div><button id="rollMinus90Btn">-90¬∞</button><button id="rollPlus90Btn">+90¬∞</button></div>
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">Yaw</div><button id="yawMinus90Btn">-90¬∞</button><button id="yawPlus90Btn">+90¬∞</button></div>
                    </div>
                    <div class="mount-rotate-90" style="display:flex; gap:8px; margin-top:6px;">
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">Monta≈º X</div><button id="mountXMinus90Btn">-90¬∞</button><button id="mountXPlus90Btn">+90¬∞</button></div>
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">Monta≈º Y</div><button id="mountYMinus90Btn">-90¬∞</button><button id="mountYPlus90Btn">+90¬∞</button></div>
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">Monta≈º Z</div><button id="mountZMinus90Btn">-90¬∞</button><button id="mountZPlus90Btn">+90¬∞</button></div>
                    </div>
                    <hr style="border-color:#2a2a35;">
                    <div style="margin-top:6px;">
                        <strong>Mapowanie osi IMU (wp≈Çyw na PID)</strong>
                        <div style="display:flex; gap:6px; margin-top:6px;">
                            <div style="flex:1;">
                                <div>Pitch (≈πr√≥d≈Ço)</div>
                                <select id="imuPitchSource"><option value="0">Pitch</option><option value="1">Yaw</option><option value="2">Roll</option></select>
                                <div class="sign-toggle" id="imuPitchSign" style="margin-top:6px;"><button data-sign="1" class="active" title="Dodatni">+1</button><button data-sign="-1" title="Ujemny">-1</button></div>
                            </div>
                            <div style="flex:1;">
                                <div>Yaw (≈πr√≥d≈Ço)</div>
                                <select id="imuYawSource"><option value="0">Pitch</option><option value="1">Yaw</option><option value="2">Roll</option></select>
                                <div class="sign-toggle" id="imuYawSign" style="margin-top:6px;"><button data-sign="1" class="active">+1</button><button data-sign="-1">-1</button></div>
                            </div>
                        </div>
                        <div style="display:flex; gap:6px; margin-top:6px; align-items:center;">
                            <div style="flex:1;">
                                <div>Roll (≈πr√≥d≈Ço)</div>
                                <select id="imuRollSource"><option value="0">Pitch</option><option value="1">Yaw</option><option value="2">Roll</option></select>
                                <div class="sign-toggle" id="imuRollSign" style="margin-top:6px;"><button data-sign="1" class="active">+1</button><button data-sign="-1">-1</button></div>
                            </div>
                            <div style="display:flex; flex-direction:column; gap:6px; min-width:120px;">
                                <button id="imuMappingLoadBtn" style="background:#61dafb;">Wczytaj</button>
                                <button id="imuMappingSaveBtn" style="background:#a2f279;">Zapisz</button>
                            </div>
                        </div>
                        <div style="display:flex; align-items:center; gap:6px; margin-top:8px;"><input id="markFrontFaceChk" type="checkbox"><label for="markFrontFaceChk">Oznacz front (g√≥ra/d√≥≈Ç) w podglƒÖdzie</label></div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button id="setModalPitchZeroBtn" style="flex:1; background:#61dafb;">Ustaw punkt 0 (Pitch)</button>
                        <button id="setModalRollZeroBtn" style="flex:1; background:#61dafb;">Ustaw punkt 0 (Roll)</button>
                    </div>
                    <hr style="border-color:#2a2a35;">
                    <div style="margin-top:6px;">
                        <strong>Ma≈Çe korekty trim√≥w</strong>
                        <div style="display:flex; gap:6px; margin-top:6px;">
                            <div style="flex:1;">
                                <div>Pitch</div>
                                <div style="display:flex; gap:2px; margin-top:4px;">
                                    <button id="pitchTrimPlus01Btn" style="flex:1; font-size:0.8em;">+0.1¬∞</button>
                                    <button id="pitchTrimMinus01Btn" style="flex:1; font-size:0.8em;">-0.1¬∞</button>
                                    <button id="pitchTrimPlus001Btn" style="flex:1; font-size:0.8em;">+0.01¬∞</button>
                                    <button id="pitchTrimMinus001Btn" style="flex:1; font-size:0.8em;">-0.01¬∞</button>
                                </div>
                            </div>
                            <div style="flex:1;">
                                <div>Roll</div>
                                <div style="display:flex; gap:2px; margin-top:4px;">
                                    <button id="rollTrimPlus01Btn" style="flex:1; font-size:0.8em;">+0.1¬∞</button>
                                    <button id="rollTrimMinus01Btn" style="flex:1; font-size:0.8em;">-0.1¬∞</button>
                                    <button id="rollTrimPlus001Btn" style="flex:1; font-size:0.8em;">+0.01¬∞</button>
                                    <button id="rollTrimMinus001Btn" style="flex:1; font-size:0.8em;">-0.01¬∞</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
                <button id="sensorWizardCancelBtn" style="background:#ff6347;">Anuluj</button>
                <button id="sensorWizardBackBtn" disabled>Wstecz</button>
                <button id="sensorWizardNextBtn" style="background:#61dafb;">Dalej</button>
            </div>
        </div>
    </div>
    
    <!-- Modal mapowania modelu 3D -->
    <div id="model-mapping-modal" class="modal-backdrop" style="display:none;">
        <div class="modal-content">
            <h2>Mapowanie Modelu 3D (Wizualizacja) <span class="help-icon" id="modelMappingHelp" title="Poka≈º/ukryj szczeg√≥≈ÇowƒÖ pomoc">?</span></h2>
            <div id="modelMappingHelpText" class="help-text" style="margin-bottom:10px;" aria-hidden="true">
                <strong>Co to robi?</strong> Przekszta≈Çca kƒÖty Euler'a (pochodne z kwaternionu) na osie sceny 3D.<br>
                <strong>Kiedy u≈ºyƒá?</strong> Je≈õli model 3D reaguje w niew≈Ça≈õciwych osiach albo odwrotnie ni≈º oczekujesz.<br>
                <strong>≈πr√≥d≈Ça:</strong> Pitch/Yaw/Roll liczone z kwaternionu (standard ZYX).<br>
                <strong>Znaki:</strong> U≈ºyj -1 aby odwr√≥ciƒá kierunek osi bez zmiany logiki sterowania.
            </div>
            <p style="text-align:left; font-size:0.85em; line-height:1.4;" title="Tylko wizualizacja, nie sterowanie">Okre≈õl, kt√≥re sk≈Çadowe kƒÖt√≥w Euler'a majƒÖ zasilaƒá osie modelu 3D oraz ich znak.</p>
            <div class="model-mapping-row">
                <strong>Pitch:</strong>
                <select id="modelPitchSource"><option value="0">Pitch</option><option value="1">Yaw</option><option value="2">Roll</option></select>
                <div class="sign-toggle" id="modelPitchSign"><button data-sign="1" class="active">+1</button><button data-sign="-1">-1</button></div>
            </div>
            <div class="model-mapping-row">
                <strong>Yaw:</strong>
                <select id="modelYawSource"><option value="0">Pitch</option><option value="1">Yaw</option><option value="2">Roll</option></select>
                <div class="sign-toggle" id="modelYawSign"><button data-sign="1" class="active">+1</button><button data-sign="-1">-1</button></div>
            </div>
            <div class="model-mapping-row">
                <strong>Roll:</strong>
                <select id="modelRollSource"><option value="0">Pitch</option><option value="1">Yaw</option><option value="2">Roll</option></select>
                <div class="sign-toggle" id="modelRollSign"><button data-sign="1" class="active">+1</button><button data-sign="-1">-1</button></div>
            </div>
            <div id="model-mapping-current">Brak danych mapowania.</div>
            <div style="display:flex; gap:10px; margin-top:12px;">
                <button id="modelMappingLoadBtn" style="flex:1; background:#61dafb;">Wczytaj</button>
                <button id="modelMappingSaveBtn" style="flex:1; background:#a2f279;">Zapisz</button>
                <button id="modelMappingResetBtn" style="flex:1; background:#f7b731;">Domy≈õlne</button>
            </div>
            <button id="modelMappingCloseBtn" style="width:100%; margin-top:14px; background:#ff6347;">Zamknij</button>
        </div>
    </div>



    <!-- Modal: Potwierdzenie EEPROM -->
    <div id="eeprom-modal" class="modal-backdrop" style="display:none;">
        <div class="modal-content" style="max-width:400px;">
            <h3 id="eeprom-modal-title">Potwierdzenie</h3>
            <p id="eeprom-modal-message">Operacja EEPROM zosta≈Ça wykonana pomy≈õlnie.</p>
            <button id="eeprom-modal-close" class="btn btn-primary" style="width:100%;">OK</button>
        </div>
    </div>


    <script src="js/ui_core.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
