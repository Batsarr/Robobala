<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RoboBala</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body class="ui-locked">
    <div id="emergency-banner">ZATRZYMANIE AWARYJNE</div>
    <div id="gamepad-mapping-modal" class="modal-backdrop">
        <div class="modal-content">
            <h2>Mapowanie Przyciskow Gamepada</h2>
            <div id="gamepad-mapping-list"></div>
            <button id="close-modal-btn" style="margin-top: 20px;">Zamknij</button>
        </div>
    </div>
    <div id="calibration-modal" class="modal-backdrop">
        <div class="modal-content">
            <h2>Kalibracja IMU (Czujnik Nachylenia)</h2>
            <p>Aby skalibrowac czujnik IMU, powoli obroc robota we wszystkich kierunkach: do przodu, do tylu, na boki i wokol wlasnej osi pionowej. Wykonaj co najmniej 3 pelne obroty w kazdej plaszczyznie.</p>
            <p><strong>Dla akcelerometru (Accel) wazne:</strong> Trzymaj robota nieruchomo na okolo 10 sekund w kazdej z 6 pozycji (szescian): gora, dol, przednia strona, tylna strona, lewa strona, prawa strona. Powtarzaj obroty i zatrzymania, az progres osiagnie co najmniej 3/4 dla kazdej osi. Obroty powinny byc wolne i plynne.</p>
            <div class="calib-axis" style="display: flex; align-items: center; margin: 10px 0; justify-content: space-between;">
                <span>Sys (System):</span><progress id="calib-sys-bar" value="0" max="3" style="flex: 1; margin: 0 10px;"></progress><span id="calib-sys-text">0</span>/3
            </div>
            <div class="calib-axis" style="display: flex; align-items: center; margin: 10px 0; justify-content: space-between;">
                <span>Accel (Przyspieszenie):</span><progress id="calib-accel-bar" value="0" max="3" style="flex: 1; margin: 0 10px;"></progress><span id="calib-accel-text">0</span>/3
            </div>
            <div class="calib-axis" style="display: flex; align-items: center; margin: 10px 0; justify-content: space-between;">
                <span>Gyro (Obroty):</span><progress id="calib-gyro-bar" value="0" max="3" style="flex: 1; margin: 0 10px;"></progress><span id="calib-gyro-text">0</span>/3
            </div>
            <div class="calib-axis" style="display: flex; align-items: center; margin: 10px 0; justify-content: space-between;">
                <span>Mag (Magnetyczne):</span><progress id="calib-mag-bar" value="0" max="3" style="flex: 1; margin: 0 10px;"></progress><span id="calib-mag-text">0</span>/3
            </div>
            <div style="display:flex; gap:8px;">
                <button id="calib-update-btn" style="flex:1;">Aktualizuj Status</button>
                <button id="calib-close-btn" style="flex:1;">Zamknij</button>
            </div>
            <div style="display:flex; justify-content:flex-end; margin-top:10px;">
                <button id="calib-save-btn" style="display:none; background:#61dafb; padding:6px 12px; border-radius:6px;">Zapisz offset do EEPROM</button>
            </div>
        </div>
    </div>

    <h1>Robot PID - Panel Sterowania v21.2</h1>
    <div class="main-grid">
        <div class="card" id="controls-card">
            <h2>Sterowanie</h2>
            <div id="joystickWrapper"><canvas id="joystickCanvas"></canvas></div>
            <div class="control-row"><span class="control-label">Balansowanie</span><label class="switch"><input type="checkbox" id="balanceSwitch"><span class="slider round"></span></label></div>
            <div class="control-row"><span class="control-label">Trzymaj Pozycje</span><label class="switch"><input type="checkbox" id="holdPositionSwitch"><span class="slider round"></span></label></div>
            <div class="control-row"><span class="control-label">Tryb Predkosci</span><label class="switch"><input type="checkbox" id="speedModeSwitch"><span class="slider round"></span></label></div>
            <div class="control-row"><span class="control-label">Wylacz Magnetometr</span><label class="switch"><input type="checkbox" id="disableMagnetometerSwitch"><span class="slider round"></span></label></div>
            <button id="open-gamepad-modal-btn" style="width: 100%; background-color:#f7b731; margin-top: 15px;">Mapowanie Przyciskow Gamepada</button>
            <button id="resetZeroBtn" style="margin-top:10px; width:100%;">Ustaw punkt 0 (Pitch)</button>
            <div class="trim-controls">
                <button id="trimMinus01Btn">-0.1</button>
                <button id="trimMinus001Btn">-0.01</button>
                <span>Korekta Pionu: <span id="trimValueDisplay">0.00</span>Â°</span>
                <button id="trimPlus001Btn">+0.01</button>
                <button id="trimPlus01Btn">+0.1</button>
            </div>
            <button id="resetRollZeroBtn" style="margin-top:10px; width:100%;">Ustaw punkt 0 (Roll)</button>
            <div class="trim-controls">
                <button id="rollTrimMinus01Btn">-0.1</button>
                <button id="rollTrimMinus001Btn">-0.01</button>
                <span>Korekta Roll: <span id="rollTrimValueDisplay">0.00</span>Â°</span>
                <button id="rollTrimPlus001Btn">+0.01</button>
                <button id="rollTrimPlus01Btn">+0.1</button>
            </div>
            <button id="resetEncodersBtn" style="margin-top:10px; background-color:#f7b731; width: 100%;">Resetuj Enkodery</button>
            <button id="emergencyStopBtn">STOP AWARYJNY</button>
            <button class="accordion-header" onclick="toggleAccordion(this)" style="margin-top: 15px;">Strojenie Joysticka</button>
            <div class="accordion-content">
                <div class="setting-container"><label for="joystickSensitivityInput">Czulosc Globalna (%)<span class="help-icon">?</span></label><div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="joystickSensitivityInput" min="10" max="100" step="5" value="100"><button>+</button></div><div class="help-text">Globalny mnoÅ¼nik dla wszystkich wartoÅ›ci z joysticka. Ustawienie 100% oznacza peÅ‚nÄ… czuÅ‚oÅ›Ä‡ - robot reaguje maksymalnie na ruchy joysticka. Zmniejsz do 50-70%, jeÅ›li robot jest zbyt nerwowy lub reaguje zbyt gwaÅ‚townie. Przydatne podczas nauki sterowania lub w ciasnych przestrzeniach. Typowy zakres: 60-100%.</div></div>
                <div class="setting-container"><label for="expoJoystickInput">Expo Joysticka (%)<span class="help-icon">?</span></label><div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="expoJoystickInput" min="0" max="90" step="1" value="0"><button>+</button></div><div class="help-text">Krzywa wykÅ‚adnicza (expo) zmienia charakterystykÄ™ odpowiedzi joysticka. Przy 0% odpowiedÅº jest liniowa. ZwiÄ™kszenie wartoÅ›ci sprawia, Å¼e przy maÅ‚ych wychyleniach robot reaguje Å‚agodniej (wiÄ™ksza precyzja), a przy duÅ¼ych wychyleniach normalnie. WartoÅ›Ä‡ 30-50% zapewnia dobrÄ… rÃ³wnowagÄ™ miÄ™dzy precyzjÄ… a responsywnoÅ›ciÄ…. Typowy zakres: 0-50%.</div></div>
                <div class="setting-container"><label for="maxSpeedJoystickInput">Max. predkosc (imp/s)<span class="help-icon">?</span></label><div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="maxSpeedJoystickInput" min="200" max="4000" step="100" value="800"><button>+</button></div><div class="help-text">Maksymalna prÄ™dkoÅ›Ä‡ zadana w trybie prÄ™dkoÅ›ci przy peÅ‚nym wychyleniu joysticka do przodu/tyÅ‚u. WyÅ¼sza wartoÅ›Ä‡ = szybszy robot. Dla bezpiecznej nauki zacznij od 500-800 imp/s. Dla sportowej jazdy moÅ¼esz zwiÄ™kszyÄ‡ do 1500-2500 imp/s. Uwaga: zbyt wysoka wartoÅ›Ä‡ moÅ¼e powodowaÄ‡ utratÄ™ balansu! Typowy zakres: 500-1500 imp/s.</div></div>
                <div class="setting-container"><label for="joystickAngleSensitivityInput">Czulosc Kata (st.)<span class="help-icon">?</span></label><div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="joystickAngleSensitivityInput" min="1" max="30" step="0.5" value="10"><button>+</button></div><div class="help-text">Maksymalny kÄ…t pochylenia zadany w trybie kÄ…ta przy peÅ‚nym wychyleniu joysticka. Mniejsza wartoÅ›Ä‡ (5-8Â°) = Å‚agodniejsze przyspieszenie, bardziej przewidywalne zachowanie. WiÄ™ksza wartoÅ›Ä‡ (12-20Â°) = agresywniejsze przyspieszenie, szybsza reakcja. Rozpocznij od 8-10Â° i dostosuj do swoich preferencji. Typowy zakres: 6-15Â°.</div></div>
                <div class="setting-container"><label for="turnFactorInput">Czulosc Skretu (%)<span class="help-icon">?</span></label><div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="turnFactorInput" min="0" max="100" step="5" value="25"><button>+</button></div><div class="help-text">Kontroluje, jak szybko robot obraca siÄ™ w miejscu przy wychyleniu joysticka w poziomie. Mniejsza wartoÅ›Ä‡ (15-25%) = powolne, pÅ‚ynne skrÄ™ty. WiÄ™ksza wartoÅ›Ä‡ (40-60%) = szybkie, ostre skrÄ™ty. Za wysoka wartoÅ›Ä‡ moÅ¼e powodowaÄ‡ utratÄ™ balansu podczas obrotu. Typowy zakres: 20-40%.</div></div>
                <div class="setting-container"><label for="joystickDeadzoneInput">Strefa Martwa (%)<span class="help-icon">?</span></label><div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="joystickDeadzoneInput" min="0" max="50" step="1" value="0"><button>+</button></div><div class="help-text">Obszar wokÃ³Å‚ Å›rodka joysticka, w ktÃ³rym ruch jest ignorowany. Przydatne, jeÅ›li joystick "dryfuje" sam z siebie lub chcesz uniknÄ…Ä‡ przypadkowych mikroruchÃ³w. WartoÅ›Ä‡ 5-10% usuwa drobne drÅ¼enia bez utraty czuÅ‚oÅ›ci. Typowy zakres: 0-15%.</div></div>
            </div>
        </div>
        <div class="card">
            <h2>Dashboard</h2>
            <button id="connectBleBtn" style="width: 100%; margin-bottom: 15px;">POLACZ Z ROBOTEM</button>
            <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: start; margin-bottom: 15px;">
                <div class="status-grid">
                    <strong>Polaczenie:</strong> <div><span id="connectionStatus" class="status-indicator status-disconnected"></span> <span id="connectionText">Rozlaczony</span></div>
                    <strong>Gamepad:</strong> <span id="gamepadStatus" style="font-weight:bold; color: #f7b731;">Brak</span>
                    <strong>Tryb Pracy:</strong> <span id="robotStateVal" style="font-weight:bold; color: #61dafb;">IDLE</span>
                    <span id="signSummary" style="margin-left:8px; font-size:0.9em; color:#a2f279;">B:+ S:+ P:+</span>
                </div>
                <div class="compass-container">
                    <div class="compass-needle" id="compassNeedle"></div>
                    <span class="compass-cardinal n">N</span>
                    <span class="compass-cardinal e">E</span>
                    <span class="compass-cardinal s">S</span>
                    <span class="compass-cardinal w">W</span>
                </div>
            </div>
             <div class="dashboard-grid">
                <div class="dashboard-item">
                    <span class="label">Czas Petli</span>
                    <span class="value" id="loopTimeVal">0 &micro;s</span>
                </div>
                <div class="dashboard-item">
                    <span class="label">Czas Petli (Å›rednio)</span>
                    <span class="value" id="loopLoadVal">-- %</span>
                </div>
                <div class="dashboard-item" id="systemHealthItem">
                    <span class="label">System Health</span>
                    <span class="value" id="systemHealthVal">OK</span>
                </div>
                <div class="dashboard-item">
                    <span class="label">Kalibracja IMU</span>
                    <span class="value">Sys: <span id="calibSysVal">-</span></span>
                    <div class="historical-metric">Acc: <span id="calibAccelVal">-</span> Gyro: <span id="calibGyroVal">-</span> Mag: <span id="calibMagVal">-</span></div>
                </div>
                <div class="dashboard-item">
                    <span class="label">Offset (Pitch)</span>
                    <span class="value" id="angleOffsetVal">0.0 Â°</span>
                    <div class="historical-metric">Delta vs initial: <span id="offsetDeltaVal">0.0 Â°</span></div>
                </div>
                <div class="dashboard-item">
                    <span class="label">Offset (Roll)</span>
                    <span class="value" id="rollOffsetVal">0.0 Â°</span>
                </div>
                <div class="dashboard-item">
                    <span class="label">Kat (Pitch)</span>
                    <span class="value" id="angleVal">0.0 &deg;</span>
                    <div class="historical-metric">(min: <span id="pitchMin">---</span>, max: <span id="pitchMax">---</span>, avg: <span id="pitchAvg">---</span>)</div>
                </div>
                <div class="dashboard-item">
                    <span class="label">Predkosc</span>
                    <span class="value" id="speedVal">0 imp/s</span>
                    <div class="historical-metric">(min: <span id="speedMin">---</span>, max: <span id="speedMax">---</span>, avg: <span id="speedAvg">---</span>)</div>
                </div>
                <div class="dashboard-item">
                    <span class="label">Kat (Roll)</span>
                    <span class="value" id="rollVal">0.0 &deg;</span>
                </div>
                <div class="dashboard-item">
                    <span class="label">Enkoder L</span>
                    <span class="value" id="encoderLeftVal">0</span>
                </div>
                <div class="dashboard-item">
                    <span class="label">Enkoder P</span>
                    <span class="value" id="encoderRightVal">0</span>
                </div>
                <div class="dashboard-item">
                    <span class="label">Kurs (Yaw)</span>
                    <span class="value" id="yawVal">0.0 Â°</span>
                </div>
            </div>
             <fieldset style="margin-top: 15px;">
                <legend>Diagnostyka</legend>
                <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                    <button id="calibrateMpuBtn" style="width:100%; background-color:#f7b731;">Asystent Kalibracji IMU</button>
                    <button id="calibrateZeroPointBtn" style="width:100%; background-color:#f7b731;">Znajdz Pion Automatycznie</button>
                    <button id="sensorMappingBtn" style="width:100%; background-color:#f7b731;">Mapowanie czujnika</button>
                    <button id="modelMappingBtn" style="width:100%; background-color:#f7b731;">Mapowanie modelu 3D</button>
                </div>
            </fieldset>
        </div>
        <div class="card">
            <h2>Wizualizacja 3D Robota</h2>
            <div id="robot3d-container"></div>
            <div class="robot3d-controls">
                <button id="reset3dViewBtn">Resetuj Widok</button>
                <button id="toggle3dAnimationBtn">Wl./Wyl. Animacje</button>
                <button id="toggle3dMovementBtn">Start/Stop Ruchu</button>
            </div>
            <div class="robot3d-info">
                <div class="robot3d-metrics">
                    <strong>Przechyl (Pitch):</strong> <span id="robot3d-pitch">0.0Â°</span>
                    <strong>Przechyl (Roll):</strong> <span id="robot3d-roll">0.0Â°</span>
                    <strong>Obrot kol:</strong> <span id="robot3d-wheel-speed">0 obr/min</span>
                    <strong>Pozycja X:</strong> <span id="robot3d-position-x">0.0 cm</span>
                    <strong>Pozycja Z:</strong> <span id="robot3d-position-z">0.0 cm</span>
                </div>
            </div>
            <fieldset style="margin-top: 15px;">
                <div class="control-row" style="margin-bottom: 15px;">
                    <span class="control-label">Perspektywa Robota</span>
                    <label class="switch"><input type="checkbox" id="robotPerspectiveCheckbox"><span class="slider round"></span></label>
                </div>
            </fieldset>
        </div>
        <div class="card">
            <h2>Analizator Sygnalow</h2>
            <div class="chart-hints">
                <strong>ğŸ’¡ WskazÃ³wki:</strong> 
                Ctrl+Scroll dla zoom | Ctrl+PrzeciÄ…gnij dla przewijania | Shift+PrzeciÄ…gnij dla zaznaczenia zakresu
            </div>
            <div id="chart-wrapper">
                <canvas id="signalAnalyzerChart"></canvas>
            </div>
            <div class="chart-toolbar">
                <button id="pauseChartBtn">â¸ï¸ Pauza</button>
                <button id="resumeChartBtn" style="display:none;">â–¶ï¸ Wznow</button>
                <button id="cursorABBtn">ğŸ“ Kursory A/B</button>
                <button id="exportCsvBtn">ğŸ“„ Eksport CSV</button>
                <button id="exportRangeCsvBtn" title="Zaznacz zakres trzymajÄ…c Shift i przeciÄ…gajÄ…c myszkÄ…">ğŸ“Š Eksport CSV (Zakres)</button>
                <button id="resetZoomBtn">ğŸ” Reset Widoku</button>
                <button id="exportPngBtn">ğŸ–¼ï¸ Eksport PNG</button>
            </div>
            <div class="chart-cursor-info" id="cursorInfo" style="display:none;">
                <div><strong>Kursor A:</strong> X: <span id="cursorAX">---</span>, Y: <span id="cursorAY">---</span></div>
                <div><strong>Kursor B:</strong> X: <span id="cursorBX">---</span>, Y: <span id="cursorBY">---</span></div>
                <div><strong>Î”t:</strong> <span id="cursorDeltaT">---</span></div>
                <div><strong>Î”y (Pitch):</strong> <span id="cursorDeltaYPitch">---</span></div>
                <div><strong>Î”y (Speed):</strong> <span id="cursorDeltaYSpeed">---</span></div>
            </div>
            <div class="chart-controls" id="signalChartControls"></div>
        </div>
        <div class="card">
             <button class="accordion-header" onclick="toggleAccordion(this)">Sterowanie Autonomiczne</button>
            <div class="accordion-content">
               <fieldset>
                   <legend>Sterowanie Precyzyjne (D-Pad)</legend>
                   <div class="dpad-input-group"><label for="dpadDistInput">Dystans (cm):</label><input type="number" id="dpadDistInput" value="20"></div>
                   <div class="dpad-input-group"><label for="dpadAngleInput">Kat (st.):</label><input type="number" id="dpadAngleInput" value="90"></div>
                   <div class="dpad-container">
                       <button id="dpad-up" class="dpad-btn" data-dpad="up">&#8593;</button><button id="dpad-left" class="dpad-btn" data-dpad="left">&#8592;</button><button id="dpad-stop" class="dpad-btn" data-dpad="stop">&#215;</button><button id="dpad-right" class="dpad-btn" data-dpad="right">&#8594;</button><button id="dpad-down" class="dpad-btn" data-dpad="down">&#8595;</button>
                   </div>
               </fieldset>
               <fieldset style="margin-top: 15px;">
                   <legend>Kreator Sekwencji Ruchow</legend>
                   <div id="sequence-list"></div>
                   <button id="add-sequence-step-btn" style="width:100%; margin: 10px 0;">Dodaj Krok</button>
                   <div style="display:flex; gap:10px; justify-content:center;">
                       <button id="run-sequence-btn" style="background-color: #a2f279;">Uruchom</button><button id="stop-sequence-btn" style="background-color: #ff6347;" disabled>Zatrzymaj</button><button id="clear-sequence-btn" style="background-color: #f7b731;">Wyczysc</button>
                   </div>
                   <h4 style="color: #61dafb; margin-top: 20px; margin-bottom: 10px;">Wizualizacja Sciezki (2D)</h4>
                   <div id="path-visualization-container">
                       <canvas id="pathCanvas"></canvas>
                       <div class="path-legend">
                           <div><span class="color-box planned"></span> Planowana</div>
                           <div><span class="color-box actual"></span> Rzeczywista</div>
                       </div>
                   </div>
                   <div id="sequence-report-panel" class="sequence-report-panel">
                       <h4>Raport Sekwencji</h4>
                       <div class="sequence-report-metrics" id="sequenceReportMetrics">
                           <div><strong>Sredni Blad Kursu:</strong> <span id="avgHeadingError">---</span></div>
                           <div><strong>Max Blad Kursu:</strong> <span id="maxHeadingError">---</span></div>
                           <div><strong>Pokonany Dystans:</strong> <span id="totalDistanceCovered">---</span></div>
                       </div>
                       <button id="resetSequenceReportBtn" style="width: 100%; margin-top: 15px;">Wyczysc Raport</button>
                   </div>
               </fieldset>
           </div>
        </div>
        <div class="card">
            <h2>Konfiguracja</h2>
            <fieldset>
                <legend>Profile Ustawien (Snapshots)</legend>
                <div class="profile-controls"> <select id="pidPresetSelect" style="width: 100%; padding: 5px;"></select> </div>
                <div class="preset-actions">
                    <button id="applySelectedPresetBtn">Zastosuj</button>
                    <button id="saveCurrentAsPresetBtn">Zapisz jako Nowy</button>
                </div>
                <button id="deleteSelectedPresetBtn" style="width:100%; margin-top: 10px; background-color: #ff6347;">Usun Wybrany</button>
                <!-- Przyciski przeniesione na dÃ³Å‚, pod wszystkimi akordeonami -->
            </fieldset>
            <div id="allSettings">
                <button class="accordion-header" onclick="toggleAccordion(this)">1. Parametry Sprzetowe i Mechaniczne</button>
                <div class="accordion-content">
                    <!-- UsuniÄ™to legacy mapowanie osi IMU â€“ zastÄ…pione nowym kreatorem 'Mapowanie czujnika' w Dashboard -->
                    <div class="setting-container"> <label for="wheelDiameterInput">Srednica kola (cm)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="wheelDiameterInput" min="1" max="30" step="0.1" value="8.2"><button>+</button></div> <div class="help-text">Åšrednica koÅ‚a robota w centymetrach. Parametr kluczowy dla obliczania prÄ™dkoÅ›ci i pokonanego dystansu. Zmierz dokÅ‚adnie Å›rednicÄ™ od krawÄ™dzi do krawÄ™dzi przez Å›rodek koÅ‚a. WiÄ™ksze koÅ‚a = wiÄ™ksza prÄ™dkoÅ›Ä‡ przy tych samych obrotach silnika. Typowy zakres: 6-12 cm.</div> </div>
                    <div class="setting-container"> <label for="trackWidthInput">Rozstaw kol (cm)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="trackWidthInput" min="5" max="50" step="0.1" value="12.5"><button>+</button></div> <div class="help-text">OdlegÅ‚oÅ›Ä‡ miÄ™dzy Å›rodkami obu kÃ³Å‚ (szerokoÅ›Ä‡ toru). WpÅ‚ywa na obliczenia obrotu - szerszy rozstaw wymaga wiÄ™kszej rÃ³Å¼nicy prÄ™dkoÅ›ci kÃ³Å‚ do wykonania tego samego skrÄ™tu. Zmierz odlegÅ‚oÅ›Ä‡ miÄ™dzy Å›rodkami osi kÃ³Å‚. Typowy zakres: 10-20 cm.</div> </div>
                    <div class="setting-container"> <label for="encoderPprInput">Impulsy na obrot (PPR)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="encoderPprInput" min="100" max="5000" step="10" value="820"><button>+</button></div> <div class="help-text">Liczba impulsÃ³w enkodera na jeden peÅ‚ny obrÃ³t koÅ‚a. ZaleÅ¼y od rozdzielczoÅ›ci enkodera i przekÅ‚adni (jeÅ›li jest). WartoÅ›Ä‡ ta wpÅ‚ywa na dokÅ‚adnoÅ›Ä‡ pomiaru prÄ™dkoÅ›ci i pozycji. WyÅ¼sza wartoÅ›Ä‡ = wiÄ™ksza precyzja. SprawdÅº specyfikacjÄ™ swojego enkodera i przekÅ‚adni. Typowy zakres: 300-2000 PPR.</div> </div>
                </div>
                <button class="accordion-header" onclick="toggleAccordion(this)">2. Kalibracja PWM Silnikow</button>
                <div class="accordion-content">
                    <div class="pwm-info"> <strong>Info:</strong> Uzyj przycisku <strong>"Auto"</strong>, aby automatycznie znalezc prog startowy silnika, lub <strong>"Testuj"</strong>, aby sprawdzic recznie wpisana wartosc. <strong>Wazne:</strong> Przed testem podnies robota, aby kola mogly sie swobodnie krecic! </div>
                    <div class="setting-container"> <label for="pwmTuneStartInput">Rozpocznij auto-szukanie od PWM</label> <div class="numeric-input-wrapper"> <button id="pwmTuneStartMinus">-</button> <input type="number" id="pwmTuneStartInput" min="1" max="2047" step="1" value="1200"> <button id="pwmTuneStartPlus">+</button> </div> </div> <hr style="border-color: #4a4f58; margin: 15px 0;">
                    <div class="manual-tune-row" data-motor="left" data-direction="fwd"> <div class="pwm-input-row"> <label>Lewy (Przod)</label> <div class="numeric-input-wrapper"><button class="tune-minus">-</button><input type="number" class="config-value tune-input" id="minPwmLeftFwdInput" min="0" max="2047" step="1" value="1200"><button>+</button></div> </div> <div class="pwm-button-row"> <button class="test-btn">Testuj</button><button class="stop-btn">Stop</button><button class="auto-btn">Auto</button></div> </div>
                    <div class="manual-tune-row" data-motor="left" data-direction="bwd"> <div class="pwm-input-row"> <label>Lewy (Tyl)</label> <div class="numeric-input-wrapper"><button class="tune-minus">-</button><input type="number" class="config-value tune-input" id="minPwmLeftBwdInput" min="0" max="2047" step="1" value="1200"><button>+</button></div> </div> <div class="pwm-button-row"> <button class="test-btn">Testuj</button><button class="stop-btn">Stop</button><button class="auto-btn">Auto</button></div> </div>
                    <div class="manual-tune-row" data-motor="right" data-direction="fwd"> <div class="pwm-input-row"> <label>Prawy (Przod)</label> <div class="numeric-input-wrapper"><button class="tune-minus">-</button><input type="number" class="config-value tune-input" id="minPwmRightFwdInput" min="0" max="2047" step="1" value="1200"><button>+</button></div> </div> <div class="pwm-button-row"> <button class="test-btn">Testuj</button><button class="stop-btn">Stop</button><button class="auto-btn">Auto</button></div> </div>
                    <div class="manual-tune-row" data-motor="right" data-direction="bwd"> <div class="pwm-input-row"> <label>Prawy (Tyl)</label> <div class="numeric-input-wrapper"><button class="tune-minus">-</button><input type="number" class="config-value tune-input" id="minPwmRightBwdInput" min="0" max="2047" step="1" value="1200"><button>+</button></div> </div> <div class="pwm-button-row"> <button class="test-btn">Testuj</button><button class="stop-btn">Stop</button><button class="auto-btn">Auto</button></div> </div>
                    <button id="manualTuneStopAll" style="width:100%; margin-top:15px; background-color:#ff6347;">ZATRZYMAJ WSZYSTKIE SILNIKI</button>
                </div>
                <button class="accordion-header" onclick="toggleAccordion(this)">3. PID Balansu (Podstawowy) <span class="sign-badge" id="balanceSignBadge">B:+</span></button>
                <div class="accordion-content">
                    <div class="setting-container"> <label for="balanceKpInput">Kp - Sila<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="balanceKpInput" min="0" max="500" step="0.1" value="95"><button>+</button></div> <div class="help-text"><strong>Proporcjonalny (Kp):</strong> OkreÅ›la, jak mocno robot reaguje na odchylenie od pionu. WyÅ¼sza wartoÅ›Ä‡ = sztywniejsze utrzymanie rÃ³wnowagi, szybsza reakcja na zakÅ‚Ã³cenia. Zbyt wysoka wartoÅ›Ä‡ powoduje szybkie oscylacje (robot "drÅ¼y"). Zbyt niska = robot reaguje za wolno i moÅ¼e upaÅ›Ä‡. Zacznij od 80-120 i dostosuj stopniowo. Typowy zakres: 60-150.</div> </div>
                    <div class="setting-container"> <label for="balanceKiInput">Ki - Korekta<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="balanceKiInput" min="0" max="10" step="0.01" value="0.0"><button>+</button></div> <div class="help-text"><strong>CaÅ‚kujÄ…cy (Ki):</strong> Eliminuje dÅ‚ugotrwaÅ‚y, staÅ‚y bÅ‚Ä…d (np. gdy robot powoli dryfuje w jednym kierunku mimo pionowego stania). CzÄ™sto nie jest potrzebny dla balansu - zacznij od 0. JeÅ›li robot ma tendencjÄ™ do dryfowania, zwiÄ™kszaj bardzo ostroÅ¼nie (np. 0.05-0.2). Zbyt wysoka wartoÅ›Ä‡ powoduje niestabilnoÅ›Ä‡ i oscylacje. Typowy zakres: 0-0.5.</div> </div>
                    <div class="setting-container"> <label for="balanceKdInput">Kd - Tlumienie<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="balanceKdInput" min="0" max="50" step="0.01" value="3.23"><button>+</button></div> <div class="help-text"><strong>RÃ³Å¼niczkujÄ…cy (Kd):</strong> DziaÅ‚a jak amortyzator - przeciwdziaÅ‚a szybkim zmianom kÄ…ta, hamuje oscylacje i wygÅ‚adza ruch. WyÅ¼sza wartoÅ›Ä‡ = bardziej uspokojony, stabilny robot, ale wolniejsza reakcja. Zbyt wysoka wartoÅ›Ä‡ powoduje "leniwy" ruch i sÅ‚abÄ… reakcjÄ™ na zakÅ‚Ã³cenia. Zbyt niska = robot jest nerwowy i drÅ¼y. Typowy zakres: 2-8.</div> </div>
                    <div class="setting-container"> <label for="balanceFilterAlphaInput">Filtr Pochodnej (%)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="balanceFilterAlphaInput" min="1" max="100" step="1" value="100"><button>+</button></div> <div class="help-text">WygÅ‚adza sygnaÅ‚ rÃ³Å¼niczkujÄ…cy (Kd), redukujÄ…c wpÅ‚yw szumÃ³w z czujnika. 100% = brak filtrowania (peÅ‚na responsywnoÅ›Ä‡, ale moÅ¼e byÄ‡ szum). Zmniejsz do 50-80%, jeÅ›li robot jest nerwowy lub "drÅ¼y" mimo niskiego Kd. NiÅ¼sza wartoÅ›Ä‡ = pÅ‚ynniejszy ruch, ale wolniejsza reakcja. Typowy zakres: 70-100%.</div> </div>
                    <div class="setting-container"> <label for="balanceIntegralLimitInput">Limit Integratora<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="balanceIntegralLimitInput" min="0" max="200" step="1" value="50"><button>+</button></div> <div class="help-text">Maksymalna wartoÅ›Ä‡, jakÄ… moÅ¼e osiÄ…gnÄ…Ä‡ suma caÅ‚kujÄ…ca (Ki). Zapobiega "rozregulowaniu" integratora przy duÅ¼ych, dÅ‚ugotrwaÅ‚ych bÅ‚Ä™dach. JeÅ›li uÅ¼ywasz Ki, ustaw limit na 30-100. JeÅ›li Ki=0, ten parametr nie ma wpÅ‚ywu. Typowy zakres: 30-100.</div> </div>
                    <div class="model-mapping-row" style="margin-top:6px;"><label>Znak sprzÄ™Å¼enia (Balans)</label><div id="balanceSign" class="sign-toggle"><button data-sign="-1">-</button><button data-sign="1">+</button></div><div class="help-text" style="margin-top:8px;">OdwrÃ³Ä‡ znak sprzÄ™Å¼enia pÄ™tli balansu (zmiana moÅ¼liwa tylko w trybie IDLE)</div></div>
                </div>
                <button class="accordion-header" onclick="toggleAccordion(this)">4. PID Kaskadowy (Predkosc/Pozycja)</button>
                <div class="accordion-content">
                    <div class="parameter-group"><h5>PID Predkosci <span class="sign-badge" id="speedSignBadge">S:+</span></h5>
                        <div class="setting-container"> <label for="speedKpInput">Kp - Reakcja<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="speedKpInput" min="0" max="10" step="0.01" value="0.0"><button>+</button></div> <div class="help-text">Kontroluje, jak mocno robot pochyla siÄ™, aby osiÄ…gnÄ…Ä‡ zadanÄ… prÄ™dkoÅ›Ä‡. WyÅ¼sza wartoÅ›Ä‡ = szybsze przyspieszanie/zwalnianie, ale moÅ¼e powodowaÄ‡ oscylacje prÄ™dkoÅ›ci. Zacznij od maÅ‚ych wartoÅ›ci (0.1-0.5) i zwiÄ™kszaj stopniowo. Typowy zakres: 0.1-2.0.</div> </div>
                        <div class="setting-container"> <label for="speedKiInput">Ki - Eliminacja bledu<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="speedKiInput" min="0" max="1" step="0.001" value="0.0"><button>+</button></div> <div class="help-text">Eliminuje staÅ‚y bÅ‚Ä…d prÄ™dkoÅ›ci (gdy robot jedzie ciÄ…gle trochÄ™ wolniej/szybciej niÅ¼ powinien). CzÄ™sto wystarczy 0, ale jeÅ›li prÄ™dkoÅ›Ä‡ nie osiÄ…ga docelowej wartoÅ›ci, dodaj maÅ‚Ä… wartoÅ›Ä‡ Ki (0.01-0.1). Zbyt wysoka wartoÅ›Ä‡ powoduje oscylacje. Typowy zakres: 0-0.2.</div> </div>
                        <div class="setting-container"> <label for="speedKdInput">Kd - Tlumienie<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="speedKdInput" min="0" max="5" step="0.001" value="0.0"><button>+</button></div> <div class="help-text">WygÅ‚adza zmiany prÄ™dkoÅ›ci, przeciwdziaÅ‚a oscylacjom. Pomaga, gdy robot "skacze" miÄ™dzy rÃ³Å¼nymi prÄ™dkoÅ›ciami. Zacznij od 0, dodaj (0.01-0.1) jeÅ›li prÄ™dkoÅ›Ä‡ oscyluje. Zbyt wysoka wartoÅ›Ä‡ spowalnia reakcjÄ™ na zmiany. Typowy zakres: 0-0.5.</div> </div>
                        <div class="setting-container"> <label for="maxTargetAngleInput">Max. kat z PID Predk. (st.)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="maxTargetAngleInput" min="1" max="45" step="0.5" value="15.0"><button>+</button></div> <div class="help-text">Maksymalny kÄ…t, jaki PID prÄ™dkoÅ›ci moÅ¼e zadaÄ‡ robotowi, aby osiÄ…gnÄ…Ä‡ docelowÄ… prÄ™dkoÅ›Ä‡. Limit bezpieczeÅ„stwa - zapobiega zbyt duÅ¼emu pochyleniu. WiÄ™ksza wartoÅ›Ä‡ = szybsze przyspieszanie, ale wiÄ™ksze ryzyko upadku. Typowy zakres: 10-20Â°.</div> </div>
                        <div class="setting-container"> <label for="speedDeadbandInput">Strefa martwa (imp/s)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="speedDeadbandInput" min="0" max="50" step="1" value="5"><button>+</button></div> <div class="help-text">JeÅ›li rzeczywista prÄ™dkoÅ›Ä‡ rÃ³Å¼ni siÄ™ od zadanej o mniej niÅ¼ ta wartoÅ›Ä‡, PID nie reaguje. Zapobiega ciÄ…gÅ‚ym mikro-korektom przy maÅ‚ych bÅ‚Ä™dach, oszczÄ™dza energiÄ™ i zmniejsza drgania. Typowy zakres: 3-15 imp/s.</div> </div>
                        <div class="setting-container"> <label for="speedIntegralLimitInput">Limit Integratora<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="speedIntegralLimitInput" min="0" max="100" step="1" value="20"><button>+</button></div> <div class="help-text">Maksymalna wartoÅ›Ä‡ sumy caÅ‚kujÄ…cej (Ki). Zapobiega "wind-up" (rozregulowaniu) integratora. Istotne tylko gdy uÅ¼ywasz Ki > 0. Typowy zakres: 10-50.</div> </div>
                        <div class="model-mapping-row" style="margin-top:6px;"><label>Znak sprzÄ™Å¼enia (PrÄ™dkoÅ›Ä‡)</label><div id="speedSign" class="sign-toggle"><button data-sign="-1">-</button><button data-sign="1">+</button></div><div class="help-text" style="margin-top:8px;">OdwrÃ³Ä‡ znak sprzÄ™Å¼enia pÄ™tli prÄ™dkoÅ›ci (zmiana moÅ¼liwa tylko w trybie IDLE)</div></div>
                        <div class="setting-container"> <label for="speedFilterAlphaInput">Filtr Pochodnej (%)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="speedFilterAlphaInput" min="1" max="100" step="1" value="80"><button>+</button></div> <div class="help-text">WygÅ‚adza sygnaÅ‚ rÃ³Å¼niczkujÄ…cy (Kd). 100% = brak filtrowania. Zmniejsz, jeÅ›li Kd wprowadza nerwowoÅ›Ä‡. Typowy zakres: 60-90%.</div> </div>
                    </div>
                    <div class="parameter-group"><h5>PID Pozycji <span class="sign-badge" id="positionSignBadge">P:+</span></h5>
                        <div class="setting-container"> <label for="positionKpInput">Kp - Sila powrotu<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="positionKpInput" min="0" max="20" step="0.1" value="0.0"><button>+</button></div> <div class="help-text">Kontroluje, jak mocno robot dÄ…Å¼y do powrotu do zadanej pozycji (funkcja "trzymaj pozycjÄ™"). WyÅ¼sza wartoÅ›Ä‡ = silniejsza korekta, szybszy powrÃ³t. Zbyt wysoka powoduje oscylacje wokÃ³Å‚ pozycji docelowej. Zacznij od 0.5-2.0. Typowy zakres: 0.5-5.0.</div> </div>
                        <div class="setting-container"> <label for="positionKiInput">Ki - Korekta<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="positionKiInput" min="0" max="1" step="0.001" value="0.0"><button>+</button></div> <div class="help-text">Usuwa staÅ‚e odchylenie od pozycji (gdy robot powoli "dryfuje" mimo wÅ‚Ä…czonej funkcji trzymania pozycji). CzÄ™sto nie jest potrzebny. Dodaj maÅ‚Ä… wartoÅ›Ä‡ (0.001-0.01) tylko jeÅ›li robot systematycznie odjeÅ¼dÅ¼a od pozycji. Typowy zakres: 0-0.05.</div> </div>
                        <div class="setting-container"> <label for="positionKdInput">Kd - Hamowanie<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="positionKdInput" min="0" max="10" step="0.05" value="0.0"><button>+</button></div> <div class="help-text">Hamuje ruch, gdy robot zbliÅ¼a siÄ™ do pozycji docelowej - zapobiega "przestrzeleniu". WyÅ¼sza wartoÅ›Ä‡ = pÅ‚ynniejsze, bardziej kontrolowane zatrzymanie, ale wolniejszy powrÃ³t. Zacznij od 0.1-0.5. Typowy zakres: 0.1-2.0.</div> </div>
                        <div class="setting-container"> <label for="maxTargetSpeedInput">Max. predkosc z PID Poz. (imp/s)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="maxTargetSpeedInput" min="100" max="4000" step="50" value="1000"><button>+</button></div> <div class="help-text">Maksymalna prÄ™dkoÅ›Ä‡, jakÄ… PID pozycji moÅ¼e zadaÄ‡ podczas powrotu do punktu. Limit bezpieczeÅ„stwa - zapobiega zbyt szybkiemu ruchowi przy duÅ¼ych odchyleniach. WyÅ¼sza wartoÅ›Ä‡ = szybszy powrÃ³t, ale wiÄ™ksze ryzyko przesterowania. Typowy zakres: 500-1500 imp/s.</div> </div>
                        <div class="setting-container"> <label for="positionDeadbandInput">Margines bledu (imp.)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="positionDeadbandInput" min="0" max="100" step="1" value="15"><button>+</button></div> <div class="help-text">JeÅ›li odchylenie od pozycji jest mniejsze niÅ¼ ta wartoÅ›Ä‡ (w impulsach enkodera), PID pozycji nie reaguje. Robot "akceptuje" to maÅ‚e odchylenie i nie prÃ³buje go korygowaÄ‡. Zapobiega ciÄ…gÅ‚ym mikro-ruchom. Typowy zakres: 10-30 imp.</div> </div>
                        <div class="setting-container"> <label for="positionIntegralLimitInput">Limit Integratora<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="positionIntegralLimitInput" min="0" max="500" step="10" value="100"><button>+</button></div> <div class="help-text">Maksymalna wartoÅ›Ä‡ sumy caÅ‚kujÄ…cej (Ki). Zapobiega "wind-up" integratora. Istotne tylko gdy Ki > 0. Typowy zakres: 50-200.</div> </div>
                        <div class="model-mapping-row" style="margin-top:6px;"><label>Znak sprzÄ™Å¼enia (Pozycja)</label><div id="positionSign" class="sign-toggle"><button data-sign="-1">-</button><button data-sign="1">+</button></div><div class="help-text" style="margin-top:8px;">OdwrÃ³Ä‡ znak sprzÄ™Å¼enia pÄ™tli pozycji (zmiana moÅ¼liwa tylko w trybie IDLE)</div></div>
                        <div class="setting-container"> <label for="positionFilterAlphaInput">Filtr Pochodnej (%)<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="positionFilterAlphaInput" min="1" max="100" step="1" value="90"><button>+</button></div> <div class="help-text">WygÅ‚adza sygnaÅ‚ rÃ³Å¼niczkujÄ…cy (Kd). 100% = brak filtrowania. Zmniejsz do 70-90%, jeÅ›li hamowanie jest "szarpane". Typowy zakres: 70-95%.</div> </div>
                    </div>
                </div>
                <button class="accordion-header" onclick="toggleAccordion(this)">5. PID Obrotu i Kursu</button>
                <div class="accordion-content">
                    <div class="parameter-group"><h5>PID Obrotu (Autonomiczny)</h5>
                        <div class="setting-container"> <label for="rotationKpInput">Kp - Sila obrotu<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="rotationKpInput" min="0" max="50" step="0.1" value="0.0"><button>+</button></div> <div class="help-text">Kontroluje moc obrotu podczas automatycznego skrÄ™tu o zadany kÄ…t. WyÅ¼sza wartoÅ›Ä‡ = szybszy obrÃ³t, ale ryzyko przesterowania (robot obraca siÄ™ za daleko). Zacznij od maÅ‚ych wartoÅ›ci (1-5) i zwiÄ™kszaj stopniowo. Typowy zakres: 2-10.</div> </div>
                        <div class="setting-container"> <label for="rotationKdInput">Kd - Tlumienie<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="rotationKdInput" min="0" max="20" step="0.1" value="0.0"><button>+</button></div> <div class="help-text">Hamuje obrÃ³t, gdy robot zbliÅ¼a siÄ™ do docelowego kÄ…ta. Zapobiega oscylacjom wokÃ³Å‚ pozycji docelowej. WyÅ¼sza wartoÅ›Ä‡ = pÅ‚ynniejsze, bardziej kontrolowane zatrzymanie. Zacznij od 0.5-2.0. Typowy zakres: 0.5-5.0.</div> </div>
                    </div>
                    <div class="parameter-group"><h5>PID Utrzymania Kursu (podczas jazdy prosto)</h5>
                        <div class="setting-container"> <label for="headingKpInput">Kp - Sila korekty<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="headingKpInput" min="0" max="10" step="0.05" value="0.0"><button>+</button></div> <div class="help-text">Kontroluje, jak mocno robot koryguje odchylenie od zadanego kursu podczas jazdy prosto. WyÅ¼sza wartoÅ›Ä‡ = mocniejsza korekta, robot jedzie bardziej "po linii". Zbyt wysoka moÅ¼e powodowaÄ‡ "zygzakowanie". Zacznij od 0.5-2.0. Typowy zakres: 0.5-5.0.</div> </div>
                        <div class="setting-container"> <label for="headingKiInput">Ki - Precyzja<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="headingKiInput" min="0" max="1" step="0.005" value="0.0"><button>+</button></div> <div class="help-text">Usuwa systematyczne odchylenie kursu (gdy robot powoli "skrÄ™ca" w jednÄ… stronÄ™ mimo jazdy prosto). Dodaj maÅ‚Ä… wartoÅ›Ä‡ (0.01-0.1) jeÅ›li robot ma tendencjÄ™ do odbijania w bok. Typowy zakres: 0-0.2.</div> </div>
                        <div class="setting-container"> <label for="headingKdInput">Kd - Tlumienie<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="headingKdInput" min="0" max="5" step="0.01" value="0.0"><button>+</button></div> <div class="help-text">WygÅ‚adza korekty kursu, zapobiega "szarpaniu" przy zmianach kierunku. Przydatne jeÅ›li robot nerwowo koryguje kurs. Zacznij od 0.05-0.2. Typowy zakres: 0.05-0.5.</div> </div>
                        <div class="setting-container"> <label for="rotationToPwmScaleInput">Skala wyjÅ›cia PID -> PWM<span class="help-icon">?</span></label> <div class="numeric-input-wrapper"><button>-</button><input type="number" class="config-value" id="rotationToPwmScaleInput" min="0" max="1" step="0.001" value="0.01"><button>+</button></div> <div class="help-text">Konwertuje wyjÅ›cie PID obrotu/kursu na komponent skrÄ™tu (PWM). ZwiÄ™ksz jeÅ›li korekty kierunku sÄ… za sÅ‚abe, zmniejsz jeÅ›li robot "przeostrza" lub oscyluje. Typowy zakres: 0.005 - 0.05.</div> </div>
                    </div>
                </div>
            </div> <!-- koniec karty Konfiguracja -->

        <!-- NOWY, ZINTEGROWANY PANEL OPTYMALIZACJI - przeniesiony poza kartÄ™ Konfiguracja aby uniknÄ…Ä‡ szarzenia -->
        <div class="card" id="autotuning-card">
            <button class="accordion-header" onclick="toggleAccordion(this)">6. Zaawansowana Optymalizacja PID</button>
            <div class="accordion-content autotune-pane" id="autotuning-card-content">
                <div id="autotuning-config-panel">
                    <!-- GÅ‚Ã³wne zakÅ‚adki panelu -->
                    <div class="autotune-main-tabs">
                        <button class="autotune-main-tab active" data-tab="config">Konfiguracja Testu</button>
                        <button class="autotune-main-tab" data-tab="methods">Metody Optymalizacji</button>
                    </div>

                    <!-- ZakÅ‚adka 1: Konfiguracja -->
                    <div class="autotune-main-content active" data-tab="config">
                        <div class="config-section">
                            <label for="tuning-loop-selector">ğŸ¯ PÄ™tla PID do strojenia:</label>
                            <select id="tuning-loop-selector" style="padding: 8px; background-color: #20232a; color: #fff; border: 1px solid #61dafb; border-radius: 4px;">
                                <option value="balance">PÄ™tla Balansu</option>
                                <option value="speed">PÄ™tla PrÄ™dkoÅ›ci</option>
                                <option value="position">PÄ™tla Pozycji</option>
                            </select>
                        </div>
                        <div class="config-section">
                            <h4>ğŸ” PrzestrzeÅ„ Przeszukiwania</h4>
                            <div class="search-space-grid">
                                <div class="search-space-param"><label for="search-kp-min">Kp Min:</label><input type="number" id="search-kp-min" value="40" step="0.1"></div>
                                <div class="search-space-param"><label for="search-kp-max">Kp Max:</label><input type="number" id="search-kp-max" value="50" step="0.1"></div>
                                <div class="search-space-param"><label for="search-ki-min">Ki Min:</label><input type="number" id="search-ki-min" value="0" step="0.01"></div>
                                <div class="search-space-param"><label for="search-ki-max">Ki Max:</label><input type="number" id="search-ki-max" value="0" step="0.01"></div>
                                <div class="search-space-param"><label for="search-kd-min">Kd Min:</label><input type="number" id="search-kd-min" value="0" step="0.01"></div>
                                <div class="search-space-param"><label for="search-kd-max">Kd Max:</label><input type="number" id="search-kd-max" value="5" step="0.01"></div>
                            </div>
                        </div>
                        <div class="config-section">
                            <h4>ğŸ§ª Parametry Testu</h4>
                            <div style="text-align: left; margin-bottom: 10px;"><label><input type="checkbox" id="test-with-impulse" checked> Test z impulsem (skok odpowiedzi)</label></div>
                            <div style="text-align: left;"><label><input type="checkbox" id="include-ki-checkbox"> UwzglÄ™dnij strojenie Ki</label></div>
                        </div>
                    </div>

                    <!-- ZakÅ‚adka 2: Metody -->
                    <div class="autotune-main-content" data-tab="methods">
                        <div class="method-tabs">
                            <button class="method-tab active" data-method="ga">ğŸ§¬ Algorytm Genetyczny</button>
                            <button class="method-tab" data-method="pso">ğŸŒ€ PSO</button>
                            <button class="method-tab" data-method="zn">ğŸ“Š Ziegler-Nichols</button>
                            <button class="method-tab" data-method="bayesian">ğŸ§  Optymalizacja Bayesowska</button>
                        </div>
                        <div class="method-content active" data-method="ga">
                            <div class="method-config">
                                <div><label for="ga-population">Rozmiar populacji:</label><input type="number" id="ga-population" value="10" min="5" max="100"></div>
                                <div><label for="ga-generations">Liczba pokoleÅ„:</label><input type="number" id="ga-generations" value="10" min="5" max="100"></div>
                                <div><label for="ga-mutation">WskaÅºnik mutacji (%):</label><input type="number" id="ga-mutation" value="10" min="0" max="100" step="1"></div>
                                <div><label for="ga-crossover">WskaÅºnik krzyÅ¼owania (%):</label><input type="number" id="ga-crossover" value="70" min="0" max="100" step="1"></div>
                                <div style="justify-content: center;"><label><input type="checkbox" id="ga-elitism" checked> Elitaryzm</label></div>
                            </div>
                        </div>
                        <div class="method-content" data-method="pso">
                            <div class="method-config">
                                <div><label for="pso-particles">Liczba czÄ…stek:</label><input type="number" id="pso-particles" value="10" min="10" max="100"></div>
                                <div><label for="pso-iterations">Liczba iteracji:</label><input type="number" id="pso-iterations" value="10" min="10" max="100"></div>
                                <div><label for="pso-inertia">Waga bezwÅ‚adnoÅ›ci:</label><input type="number" id="pso-inertia" value="0.7" min="0" max="1" step="0.01"></div>
                                <div><label for="pso-cognitive">Waga poznawcza:</label><input type="number" id="pso-cognitive" value="1.5" min="0" max="3" step="0.1"></div>
                                <div><label for="pso-social">Waga spoÅ‚eczna:</label><input type="number" id="pso-social" value="1.5" min="0" max="3" step="0.1"></div>
                            </div>
                        </div>
                        <div class="method-content" data-method="zn">
                             <div class="method-config">
                                <div><label for="zn-amplitude">Amplituda przekaÅºnika:</label><input type="number" id="zn-amplitude" value="2.0" min="0.5" max="10" step="0.5"></div>
                                <div><label for="zn-min-cycles">Minimalna liczba cykli:</label><input type="number" id="zn-min-cycles" value="3" min="2" max="10"></div>
                            </div>
                        </div>
                        <div class="method-content" data-method="bayesian">
                            <div class="method-config">
                                <div><label for="bayesian-iterations">Liczba iteracji:</label><input type="number" id="bayesian-iterations" value="25" min="10" max="50"></div>
                                <div><label for="bayesian-initial">PoczÄ…tkowe prÃ³bki losowe:</label><input type="number" id="bayesian-initial" value="5" min="3" max="10"></div>
                                <div><label for="bayesian-acquisition">Funkcja akwizycji:</label>
                                    <select id="bayesian-acquisition" style="padding: 8px; background: #20232a; border: 1px solid #61dafb; border-radius: 4px; color: #ffffff;">
                                        <option value="ei">Expected Improvement (EI)</option>
                                        <option value="ucb">Upper Confidence Bound (UCB)</option>
                                        <option value="pi">Probability of Improvement (PI)</option>
                                    </select>
                                </div>
                                <div><label for="bayesian-xi">Parametr eksploracji (Î¾):</label><input type="number" id="bayesian-xi" value="0.01" min="0" max="1" step="0.01"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ZakÅ‚adka 3: ZbiÃ³r Danych -->
                    
                </div>

                <!-- Panel PostÄ™pu Strojenia (domyÅ›lnie ukryty) -->
                <div id="tuning-progress-panel">
                    <h4>ğŸ“Š PostÄ™p Optymalizacji</h4>
                    <div class="progress-info">
                            <p>Status: <span id="tuning-status-text">Oczekuje</span></p>
                            <p>Iteracja: <span id="current-iteration">0</span> / <span id="total-iterations">0</span></p>
                            <p>Pokolenie: <span id="current-generation">0</span> / <span id="ga-gen-total">0</span></p>
                            <p>Osobnik: <span id="current-individual">0</span> / <span id="population-size">0</span></p>
                            <p>Parametry: Kp: <span id="current-kp">---</span> Ki: <span id="current-ki">---</span> Kd: <span id="current-kd">---</span></p>
                            <p>Fitness: <span id="current-fitness">---</span></p>
                        </div>
                    <div id="fitness-chart-container"><canvas id="fitness-chart"></canvas></div>
                    <div class="current-best">
                        <h4>ğŸ† Najlepsze Znalezione Parametry</h4>
                        <div class="current-best-grid">
                            <div><strong>Kp:</strong> <span id="best-kp">---</span></div>
                            <div><strong>Ki:</strong> <span id="best-ki">---</span></div>
                            <div><strong>Kd:</strong> <span id="best-kd">---</span></div>
                            <div style="grid-column: 1 / -1;"><strong>Fitness:</strong> <span id="best-fitness">---</span></div>
                        </div>
                        <button id="apply-best-btn" style="width:100%; margin-top:10px; background-color: #a2f279;" disabled>âœ… Zastosuj Najlepsze</button>
                    </div>
                    <div class="recent-results" style="margin-top: 15px; text-align: left;">
                        <h4>ğŸ•’ Ostatnie 5 prÃ³b</h4>
                        <div id="recent-results-list" style="background:#20232a; border:1px solid #4a4f58; border-radius:6px; padding:8px; font-family: monospace; white-space: pre-wrap; min-height: 40px;">
                            Brak danych.
                        </div>
                        <button id="open-tuning-history-btn" class="btn-small" style="margin-top:10px;">ğŸ“œ Historia i Eksport</button>
                    </div>
                </div>

                <!-- GÅ‚Ã³wne Przyciski SterujÄ…ce (widoczne tylko w zakÅ‚adce 'Metody Optymalizacji') -->
                <div class="tuning-controls" id="tuning-controls-bar">
                    <button id="start-tuning-btn">ğŸš€ Rozpocznij Strojenie</button>
                    <button id="pause-tuning-btn" disabled>â¸ï¸ Pauza</button>
                    <button id="resume-tuning-btn" style="display:none;" disabled>â–¶ï¸ WznÃ³w</button>
                    <button id="stop-tuning-btn" disabled>â¹ï¸ Zatrzymaj</button>
                </div>
            </div>
        </div>
        <div class="button-group" style="display:flex; gap:10px; justify-content:center; margin-top:20px; grid-column: 1 / -1;">
            <button id="loadBtn">Wczytaj z Robota</button>
            <button id="saveBtn">Zapisz na Robocie</button>
        </div>
    <div class="card" id="log-card" style="position: fixed; left: 0; right: 0; bottom: 0; z-index: 3000; margin: 0; border-radius: 0; padding-bottom: 0; box-shadow: 0 -4px 10px rgba(0,0,0,0.35);">
            <div style="display:flex; align-items:center; gap:10px; cursor:pointer;" id="log-toggle-bar" title="RozwiÅ„/ZwiÅ„ logi">
                <h2 style="margin: 0;">Logi</h2>
                <div style="margin-left:auto; display:flex; align-items:center; gap:10px;">
                    <label style="font-size:0.9em; color:#ccc; display:flex; align-items:center; gap:6px;">Autoscroll <input type="checkbox" id="logsAutoscroll" checked></label>
                    <button id="clearLogsBtn" class="btn-small" style="background:#f7b731;">WyczyÅ›Ä‡</button>
                </div>
            </div>
            <div id="log-history" style="max-height: 40vh; overflow-y: auto; display: none;"></div>
        </div>
    </div>
    <!-- Nowy modal: Mapowanie czujnika â€“ sekwencyjny kreator z auto-wykryciem obrotu > 90Â° -->
    
    <!-- Modal: Historia prÃ³b strojenia -->
    <div id="tuning-history-modal" class="modal-backdrop" style="display:none;">
        <div class="modal-content" style="max-width:1000px;">
            <h2>Historia wszystkich prÃ³b</h2>
            <div style="display:flex; gap:8px; margin-bottom:8px;">
                <button id="closeHistoryBtn" style="background:#ff6347;">Zamknij</button>
                <button id="exportHistoryCsvBtn" style="background:#61dafb;">Eksport CSV</button>
                <span id="historyCount" style="margin-left:auto; color:#aaa;"></span>
            </div>
            <div class="autotune-results-container">
                <table class="autotune-results-table" style="display:table;">
                    <thead>
                        <tr><th>#</th><th>Kp</th><th>Ki</th><th>Kd</th><th>Fitness</th><th>ITAE</th><th>Przeregul.</th><th>Akcja</th></tr>
                    </thead>
                    <tbody id="results-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="sensor-mapping-modal" class="modal-backdrop" style="display:none;">
        <div class="modal-content">
            <h2>Mapowanie Czujnika (Orientacja) <span class="help-icon" id="sensorMappingHelp" title="PokaÅ¼/ukryj szczegÃ³Å‚owÄ… pomoc">?</span></h2>
            <div id="sensorMappingHelpText" class="help-text" style="margin-bottom:10px;" aria-hidden="true">
                <strong>Cel:</strong> Dopasowanie fizycznego montaÅ¼u IMU do oczekiwanych osi sterowania robota.<br>
                <strong>Kroki:</strong> (1) Pozycja pionowa referencyjna. (2) ObrÃ³t poziomy â‰¥ 90Â°. (3) Zapis korekcji.<br>
                <strong>WpÅ‚yw:</strong> DziaÅ‚a na wewnÄ™trzne wektory (akcelerometr/Å¼yroskop) uÅ¼ywane przez PID. Nie zmienia wizualizacji 3D (oddzielne mapowanie modelu).<br>
                <strong>Wymagane:</strong> Kalibracja IMU (System=3) dla najlepszej dokÅ‚adnoÅ›ci.<br>
                <em>Po zapisie sterowanie bÄ™dzie korzystaÄ‡ z poprawionych osi automatycznie.</em>
            </div>
            <div id="sensorWizardStepInfo" style="margin:6px 0; font-size:12px; color:#aaa;">Krok <span id="sensorWizardStepNo">1</span>/3</div>
            <div id="sensorWizardText" style="text-align:left; font-size:0.95em; line-height:1.5; background:#101014; border:1px solid #2a2a35; padding:12px; border-radius:8px;">
                <!-- dynamiczna instrukcja -->
            </div>
            <div id="sensorWizardHint" style="margin-top:8px; font-size:0.85em; color:#bbb;">
                <!-- dynamiczne podpowiedzi -->
            </div>
            <div id="sensorWizardProgress" style="margin-top:12px; font-family:monospace; background:#111; border:1px solid #333; border-radius:6px; padding:8px; text-align:left;">
                [ ] Pion | [ ] Rotacja â‰¥ 90Â° | [ ] Zapis
            </div>
            <div class="sensor-mapping-wrapper" style="display:flex; gap:10px; margin-top:12px; align-items:flex-start;">
                <div id="sensor-mapping-preview" class="sensor-mapping-preview" style="flex:1; min-width:250px; height:200px; background:#000; border-radius:6px; overflow:hidden;"></div>
                    <div class="sensor-mapping-controls" style="width:320px; display:flex; flex-direction:column; gap:8px;">
                    <div style="display:flex; justify-content:space-between; gap:6px;">
                        <div>
                            <div>Pitch (Cube): <span id="modal-pitch-display">0.0Â°</span></div>
                            <div style="font-size:0.8em; color:#9fa;">Telemetry: <span id="modal-pitch-telemetry">0.0Â°</span></div>
                        </div>
                        <div>
                            <div>Roll (Cube): <span id="modal-roll-display">0.0Â°</span></div>
                            <div style="font-size:0.8em; color:#9fa;">Telemetry: <span id="modal-roll-telemetry">0.0Â°</span></div>
                        </div>
                        <div>
                            <div>Yaw (Cube): <span id="modal-yaw-display">0.0Â°</span></div>
                            <div style="font-size:0.8em; color:#9fa;">Telemetry: <span id="modal-yaw-telemetry">0.0Â°</span></div>
                        </div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">Pitch</div><button id="pitchMinus90Btn">-90Â°</button><button id="pitchPlus90Btn">+90Â°</button></div>
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">Roll</div><button id="rollMinus90Btn">-90Â°</button><button id="rollPlus90Btn">+90Â°</button></div>
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">Yaw</div><button id="yawMinus90Btn">-90Â°</button><button id="yawPlus90Btn">+90Â°</button></div>
                    </div>
                    <div class="mount-rotate-90" style="display:flex; gap:8px; margin-top:6px;">
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">MontaÅ¼ X</div><button id="mountXMinus90Btn">-90Â°</button><button id="mountXPlus90Btn">+90Â°</button></div>
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">MontaÅ¼ Y</div><button id="mountYMinus90Btn">-90Â°</button><button id="mountYPlus90Btn">+90Â°</button></div>
                        <div style="flex:1;"><div style="font-size:0.9em; margin-bottom:4px;">MontaÅ¼ Z</div><button id="mountZMinus90Btn">-90Â°</button><button id="mountZPlus90Btn">+90Â°</button></div>
                    </div>
                    <!-- DODANE: Kontrolki remapu IMU (wpÅ‚ywajÄ… na wewnÄ™trzne wektory - PID) -->
                    <hr style="border-color:#2a2a35;">
                    <div style="margin-top:6px;">
                        <strong>Mapowanie osi IMU (wpÅ‚yw na PID)</strong>
                        <div style="display:flex; gap:6px; margin-top:6px;">
                            <div style="flex:1;">
                                <div>Pitch (Å¹rÃ³dÅ‚o)</div>
                                <select id="imuPitchSource"><option value="0">Pitch</option><option value="1">Yaw</option><option value="2">Roll</option></select>
                                <div class="sign-toggle" id="imuPitchSign" style="margin-top:6px;"><button data-sign="1" class="active" title="Dodatni">+1</button><button data-sign="-1" title="Ujemny">-1</button></div>
                            </div>
                            <div style="flex:1;">
                                <div>Yaw (Å¹rÃ³dÅ‚o)</div>
                                <select id="imuYawSource"><option value="0">Pitch</option><option value="1">Yaw</option><option value="2">Roll</option></select>
                                <div class="sign-toggle" id="imuYawSign" style="margin-top:6px;"><button data-sign="1" class="active">+1</button><button data-sign="-1">-1</button></div>
                            </div>
                        </div>
                        <div style="display:flex; gap:6px; margin-top:6px; align-items:center;">
                            <div style="flex:1;">
                                <div>Roll (Å¹rÃ³dÅ‚o)</div>
                                <select id="imuRollSource"><option value="0">Pitch</option><option value="1">Yaw</option><option value="2">Roll</option></select>
                                <div class="sign-toggle" id="imuRollSign" style="margin-top:6px;"><button data-sign="1" class="active">+1</button><button data-sign="-1">-1</button></div>
                            </div>
                            <div style="display:flex; flex-direction:column; gap:6px; min-width:120px;">
                                <button id="imuMappingLoadBtn" style="background:#61dafb;">Wczytaj</button>
                                <button id="imuMappingSaveBtn" style="background:#a2f279;">Zapisz</button>
                            </div>
                        </div>
                        <div style="display:flex; align-items:center; gap:6px; margin-top:8px;"><input id="markFrontFaceChk" type="checkbox"><label for="markFrontFaceChk">Oznacz front (gÃ³ra/dÃ³Å‚) w podglÄ…dzie</label></div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button id="setModalPitchZeroBtn" style="flex:1; background:#61dafb;">Ustaw punkt 0 (Pitch)</button>
                        <button id="setModalRollZeroBtn" style="flex:1; background:#61dafb;">Ustaw punkt 0 (Roll)</button>
                    </div>
                </div>
            </div>
            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
                <button id="sensorWizardCancelBtn" style="background:#ff6347;">Anuluj</button>
                <button id="sensorWizardBackBtn" disabled>Wstecz</button>
                <button id="sensorWizardNextBtn" style="background:#61dafb;">Dalej</button>
            </div>
        </div>
    </div>
    <!-- Modal mapowania modelu 3D -->
    <div id="model-mapping-modal" class="modal-backdrop" style="display:none;">
        <div class="modal-content">
            <h2>Mapowanie Modelu 3D (Wizualizacja) <span class="help-icon" id="modelMappingHelp" title="PokaÅ¼/ukryj szczegÃ³Å‚owÄ… pomoc">?</span></h2>
            <div id="modelMappingHelpText" class="help-text" style="margin-bottom:10px;" aria-hidden="true">
                <strong>Co to robi?</strong> PrzeksztaÅ‚ca kÄ…ty Euler'a (pochodne z kwaternionu) na osie sceny 3D.<br>
                <strong>Kiedy uÅ¼yÄ‡?</strong> JeÅ›li model 3D reaguje w niewÅ‚aÅ›ciwych osiach albo odwrotnie niÅ¼ oczekujesz.<br>
                <strong>Å¹rÃ³dÅ‚a:</strong> Pitch/Yaw/Roll liczone z kwaternionu (standard ZYX).<br>
                <strong>Znak:</strong> UÅ¼yj -1 aby odwrÃ³ciÄ‡ kierunek osi bez zmiany logiki sterowania.<br>
                <em>Zmiany nie wpÅ‚ywajÄ… na kontrolÄ™ robota â€“ tylko na wizualizacjÄ™.</em>
            </div>
            <p style="text-align:left; font-size:0.85em; line-height:1.4;" title="Tylko wizualizacja, nie sterowanie">OkreÅ›l, ktÃ³re skÅ‚adowe kÄ…tÃ³w Euler'a majÄ… zasilaÄ‡ osie modelu 3D oraz ich znak.</p>
            <div class="model-mapping-row" title="Å¹rÃ³dÅ‚o oraz znak dla osi Pitch modelu">
                <strong>Pitch:</strong>
                <select id="modelPitchSource" title="Wybierz z ktÃ³rej osi Euler bÄ™dzie pochodziÄ‡ Pitch modelu">
                    <option value="0">Pitch</option>
                    <option value="1">Yaw</option>
                    <option value="2">Roll</option>
                </select>
                <div class="sign-toggle" id="modelPitchSign" title="Znak osi Pitch">
                    <button data-sign="1" class="active" title="Dodatni kierunek">+1</button>
                    <button data-sign="-1" title="OdwrÃ³Ä‡ kierunek">-1</button>
                </div>
            </div>
            <div class="model-mapping-row" title="Å¹rÃ³dÅ‚o oraz znak dla osi Yaw modelu">
                <strong>Yaw:</strong>
                <select id="modelYawSource" title="Wybierz z ktÃ³rej osi Euler bÄ™dzie pochodziÄ‡ Yaw modelu">
                    <option value="0">Pitch</option>
                    <option value="1">Yaw</option>
                    <option value="2">Roll</option>
                </select>
                <div class="sign-toggle" id="modelYawSign" title="Znak osi Yaw">
                    <button data-sign="1" class="active" title="Dodatni kierunek">+1</button>
                    <button data-sign="-1" title="OdwrÃ³Ä‡ kierunek">-1</button>
                </div>
            </div>
            <div class="model-mapping-row" title="Å¹rÃ³dÅ‚o oraz znak dla osi Roll modelu">
                <strong>Roll:</strong>
                <select id="modelRollSource" title="Wybierz z ktÃ³rej osi Euler bÄ™dzie pochodziÄ‡ Roll modelu">
                    <option value="0">Pitch</option>
                    <option value="1">Yaw</option>
                    <option value="2">Roll</option>
                </select>
                <div class="sign-toggle" id="modelRollSign" title="Znak osi Roll">
                    <button data-sign="1" class="active" title="Dodatni kierunek">+1</button>
                    <button data-sign="-1" title="OdwrÃ³Ä‡ kierunek">-1</button>
                </div>
            </div>
            <div id="model-mapping-current" title="Aktualna konfiguracja mapowania">Brak danych mapowania.</div>
            <div style="display:flex; gap:10px; margin-top:12px;">
                <button id="modelMappingLoadBtn" style="flex:1; background:#61dafb;" title="Pobierz aktualne wartoÅ›ci z EEPROM">Wczytaj</button>
                <button id="modelMappingSaveBtn" style="flex:1; background:#a2f279;" title="Zapisz bieÅ¼Ä…ce ustawienia do EEPROM">Zapisz</button>
                <button id="modelMappingResetBtn" style="flex:1; background:#f7b731;" title="PrzywrÃ³Ä‡ wartoÅ›ci domyÅ›lne (identity)">DomyÅ›lne</button>
            </div>
            <button id="modelMappingCloseBtn" style="width:100%; margin-top:14px; background:#ff6347;" title="Zamknij okno">Zamknij</button>
        </div>
    </div>

    <!-- WARNING: Do NOT include both the production bundle and modular JS files in the same page.
        For development, use 'index-dev.html' which loads the modular scripts in dependency order.
        The bundler is available as a single file 'js/main.js' for production. -->
    <!-- Required dependencies for main.js (must be loaded prior to main): -->
    <script src="js/state_manager.js"></script>
    <script src="js/communication_layer.js"></script>
    <script src="js/helpers.js"></script>
    <!-- Nowy moduÅ‚ komponentÃ³w UI (wyodrÄ™bnione z dawnych czÄ™Å›ci main.js) -->
    <script src="js/ui_components.js"></script>
    <script src="js/path_visualization.js"></script>
    <script src="js/tuning_algorithms.js"></script>
    <!-- Minimalny rdzeÅ„ inicjalizacji (joystick + 3D) po komponentach -->
    <script src="js/ui_core.js"></script>
    <!-- UWAGA: UsuniÄ™to produkcyjny bundle main.js w celu unikniÄ™cia duplikacji klas (GA/PSO) podczas debugowania.
        UÅ¼ywamy modularnych plikÃ³w ÅºrÃ³dÅ‚owych aby zapewniÄ‡ poprawne oczekiwanie na wyniki testÃ³w (runMetricsTest gating). -->
    <!-- <script src="js/main.js"></script> -->

</body>
</html>
